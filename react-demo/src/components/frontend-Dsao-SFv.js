var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n,r,o,s={},i={},a={},u={},c={},l={},d={};function f(){if(n)return d;n=1;var t=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};function o(){if("undefined"==typeof window)throw Error("If you are using this package with server-side rendering, please make sure that you are checking if the window object is defined.");return window}Object.defineProperty(d,"__esModule",{value:!0}),d.defaultWindowHandlerImplementation=void 0;var s={key:function(e){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().localStorage.key(e)]}))}))},clear:function(){return t(this,void 0,void 0,(function(){return r(this,(function(e){return[2,o().localStorage.clear()]}))}))},getItem:function(e){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().localStorage.getItem(e)]}))}))},removeItem:function(e){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().localStorage.removeItem(e)]}))}))},setItem:function(e,n){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().localStorage.setItem(e,n)]}))}))},keySync:function(e){return o().localStorage.key(e)},clearSync:function(){return o().localStorage.clear()},getItemSync:function(e){return o().localStorage.getItem(e)},removeItemSync:function(e){return o().localStorage.removeItem(e)},setItemSync:function(e,t){return o().localStorage.setItem(e,t)}},i={key:function(e){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().sessionStorage.key(e)]}))}))},clear:function(){return t(this,void 0,void 0,(function(){return r(this,(function(e){return[2,o().sessionStorage.clear()]}))}))},getItem:function(e){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().sessionStorage.getItem(e)]}))}))},removeItem:function(e){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().sessionStorage.removeItem(e)]}))}))},setItem:function(e,n){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o().sessionStorage.setItem(e,n)]}))}))},keySync:function(e){return o().sessionStorage.key(e)},clearSync:function(){return o().sessionStorage.clear()},getItemSync:function(e){return o().sessionStorage.getItem(e)},removeItemSync:function(e){return o().sessionStorage.removeItem(e)},setItemSync:function(e,t){return o().sessionStorage.setItem(e,t)}};return d.defaultWindowHandlerImplementation={history:{replaceState:function(e,t,n){return o().history.replaceState(e,t,n)},getState:function(){return o().history.state}},location:{getHref:function(){return o().location.href},setHref:function(e){o().location.href=e},getSearch:function(){return o().location.search},getHash:function(){return o().location.hash},getPathName:function(){return o().location.pathname},assign:function(e){o().location.assign(e)},getHostName:function(){return o().location.hostname},getHost:function(){return o().location.host},getOrigin:function(){return o().location.origin}},getDocument:function(){return o().document},getWindowUnsafe:function(){return o().window},localStorage:s,sessionStorage:i},d}function h(){if(r)return l;r=1,Object.defineProperty(l,"__esModule",{value:!0}),l.WindowHandlerReference=void 0;var e=f(),t=function(){function t(t){var n=function(e){return e};void 0!==t&&(n=t),this.windowHandler=n(e.defaultWindowHandlerImplementation)}return t.init=function(e){void 0===t.instance&&(t.instance=new t(e))},t.getReferenceOrThrow=function(){if(void 0===t.instance)throw new Error("SuperTokensWindowHandler must be initialized before calling this method.");return t.instance},t}();return l.WindowHandlerReference=t,l.default=t,l}(o=c).__esModule=!0,function(e){for(var t in e)o.hasOwnProperty(t)||(o[t]=e[t])}(h()),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WindowHandlerReference=void 0;var t=c;Object.defineProperty(e,"WindowHandlerReference",{enumerable:!0,get:function(){return t.WindowHandlerReference}})}(u);var p={};Object.defineProperty(p,"__esModule",{value:!0}),p.SSR_ERROR=p.DEFAULT_API_BASE_PATH=void 0,p.DEFAULT_API_BASE_PATH="/auth",p.SSR_ERROR="\nIf you are trying to use this method doing server-side-rendering, please make sure you move this method inside a componentDidMount method or useEffect hook.";var g={};Object.defineProperty(g,"__esModule",{value:!0});var v=function(e){var t=this;this.getAsStringDangerous=function(){return t.value},this.value=m(e)};function m(e,t){void 0===t&&(t=!1),e=e.trim();try{if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new Error("Error converting to proper URL");var n=new URL(e);return e=t?n.hostname.startsWith("localhost")||(r=n.hostname,/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(r))?"http://"+n.host:"https://"+n.host:n.protocol+"//"+n.host}catch(e){}var r;if(e.startsWith("/"))throw new Error("Please provide a valid domain name");if(0===e.indexOf(".")&&(e=e.substr(1)),(-1!==e.indexOf(".")||e.startsWith("localhost"))&&!e.startsWith("http://")&&!e.startsWith("https://")){e="https://"+e;try{return new URL(e),m(e,!0)}catch(e){}}throw new Error("Please provide a valid domain name")}g.default=v;var b={};Object.defineProperty(b,"__esModule",{value:!0});var y=function e(t){var n=this;this.startsWith=function(e){return n.value.startsWith(e.value)},this.appendPath=function(t){return new e(n.value+t.value)},this.getAsStringDangerous=function(){return n.value},this.value=w(t)};function w(e){e=e.trim();try{if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new Error("Error converting to proper URL");return"/"===(e=new URL(e).pathname).charAt(e.length-1)?e.substr(0,e.length-1):e}catch(e){}if((function(e){if(-1===e.indexOf(".")||e.startsWith("/"))return!1;try{return-1!==new URL(e).hostname.indexOf(".")}catch(e){}try{return-1!==new URL("http://"+e).hostname.indexOf(".")}catch(e){}return!1}(e)||e.startsWith("localhost"))&&!e.startsWith("http://")&&!e.startsWith("https://"))return w(e="http://"+e);"/"!==e.charAt(0)&&(e="/"+e);try{return new URL("http://example.com"+e),w("http://example.com"+e)}catch(e){throw new Error("Please provide a valid URL path")}}b.default=y;var I,S={},k={},R={},T={};function P(){if(I)return T;function e(e){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)}I=1,Object.defineProperty(T,"__esModule",{value:!0}),T.isAnIpAddress=void 0,T.isAnIpAddress=e;var t=function(e){var t=this;this.getAsStringDangerous=function(){return t.value},this.value=n(e)};function n(t,r){void 0===r&&(r=!1),t=t.trim();try{if(!t.startsWith("http://")&&!t.startsWith("https://"))throw new Error("converting to proper URL");var o=new URL(t);return t=r?o.hostname.startsWith("localhost")||e(o.hostname)?"http://"+o.host:"https://"+o.host:o.protocol+"//"+o.host}catch(e){}if(t.startsWith("/"))throw new Error("Please provide a valid domain name");if(0===t.indexOf(".")&&(t=t.substr(1)),(-1!==t.indexOf(".")||t.startsWith("localhost"))&&!t.startsWith("http://")&&!t.startsWith("https://")){t="https://"+t;try{return new URL(t),n(t,!0)}catch(e){}}throw new Error("Please provide a valid domain name")}return T.default=t,T}var _,A,E={};function O(){if(_)return E;_=1,Object.defineProperty(E,"__esModule",{value:!0});var e=function e(n){var r=this;this.startsWith=function(e){return r.value.startsWith(e.value)},this.appendPath=function(t){return new e(r.value+t.value)},this.getAsStringDangerous=function(){return r.value},this.value=t(n)};function t(e){e=e.trim();try{if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new Error("converting to proper URL");return"/"===(e=new URL(e).pathname).charAt(e.length-1)?e.substr(0,e.length-1):e}catch(e){}if((function(e){if(-1===e.indexOf(".")||e.startsWith("/"))return!1;try{return-1!==new URL(e).hostname.indexOf(".")}catch(e){}try{return-1!==new URL("http://"+e).hostname.indexOf(".")}catch(e){}return!1}(e)||e.startsWith("localhost"))&&!e.startsWith("http://")&&!e.startsWith("https://"))return t(e="http://"+e);"/"!==e.charAt(0)&&(e="/"+e);try{return new URL("http://example.com"+e),t("http://example.com"+e)}catch(e){throw new Error("Please provide a valid URL path")}}return E.default=e,E}function x(){if(A)return R;A=1;var t=e&&e.__assign||function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)},n=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(R,"__esModule",{value:!0}),R.getNormalisedUserContext=R.validateAndNormaliseInputOrThrowError=R.normaliseSessionScopeOrThrowError=R.normaliseURLPathOrThrowError=R.normaliseURLDomainOrThrowError=void 0;var o=P(),s=O(),i=h();function a(e){return new o.default(e).getAsStringDangerous()}function u(e){return new s.default(e).getAsStringDangerous()}function c(e){var t=function(e){(e=e.trim().toLowerCase()).startsWith(".")&&(e=e.substr(1)),e.startsWith("http://")||e.startsWith("https://")||(e="http://"+e);try{return(e=new URL(e).hostname).startsWith(".")&&(e=e.substr(1)),e}catch(e){throw new Error("Please provide a valid sessionTokenFrontendDomain")}}(e);return"localhost"===t||(0,o.isAnIpAddress)(t)?t:e.startsWith(".")?"."+t:t}return R.normaliseURLDomainOrThrowError=a,R.normaliseURLPathOrThrowError=u,R.normaliseSessionScopeOrThrowError=c,R.validateAndNormaliseInputOrThrowError=function(e){var o=this,s=a(e.apiDomain),l=u("/auth");void 0!==e.apiBasePath&&(l=u(e.apiBasePath));var d=i.default.getReferenceOrThrow().windowHandler.location.getHostName(),f=c(void 0!==e&&void 0!==e.sessionTokenFrontendDomain?e.sessionTokenFrontendDomain:d),h=401;void 0!==e.sessionExpiredStatusCode&&(h=e.sessionExpiredStatusCode);var p=403;if(void 0!==e.invalidClaimStatusCode&&(p=e.invalidClaimStatusCode),h===p)throw new Error("sessionExpiredStatusCode and invalidClaimStatusCode cannot be the same.");var g=!0;void 0!==e.autoAddCredentials&&(g=e.autoAddCredentials);var v=!1;void 0!==e.isInIframe&&(v=e.isInIframe);var m=void 0;void 0!==e.sessionTokenBackendDomain&&(m=c(e.sessionTokenBackendDomain));var b=function(e){return n(o,void 0,void 0,(function(){return r(this,(function(t){return[2,{url:e.url,requestInit:e.requestInit}]}))}))};void 0!==e.preAPIHook&&(b=e.preAPIHook);var y=function(){return n(o,void 0,void 0,(function(){return r(this,(function(e){return[2]}))}))};void 0!==e.postAPIHook&&(y=e.postAPIHook);var w=function(){};void 0!==e.onHandleEvent&&(w=e.onHandleEvent);var I=t({functions:function(e){return e}},e.override);return{apiDomain:s,apiBasePath:l,sessionTokenFrontendDomain:f,sessionExpiredStatusCode:h,invalidClaimStatusCode:p,autoAddCredentials:g,isInIframe:v,tokenTransferMethod:void 0!==e.tokenTransferMethod?e.tokenTransferMethod:"cookie",sessionTokenBackendDomain:m,preAPIHook:b,postAPIHook:y,onHandleEvent:w,override:I}},R.getNormalisedUserContext=function(e){return void 0===e?{}:e},R}var C,D={},M={};function U(){return C||(C=1,function(t){var n,r=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},o=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProcessState=t.PROCESS_STATE=void 0,(n=t.PROCESS_STATE||(t.PROCESS_STATE={}))[n.CALLING_INTERCEPTION_REQUEST=0]="CALLING_INTERCEPTION_REQUEST",n[n.CALLING_INTERCEPTION_RESPONSE=1]="CALLING_INTERCEPTION_RESPONSE";var s=function(){function e(){var e=this;this.history=[],this.addState=function(t){try{void 0!==process&&void 0!==process.env&&"testing"===process.env.TEST_MODE&&e.history.push(t)}catch(e){}},this.getEventByLastEventByName=function(t){for(var n=e.history.length-1;n>=0;n--)if(e.history[n]==t)return e.history[n]},this.reset=function(){e.history=[]},this.waitForEvent=function(t,n){return void 0===n&&(n=7e3),r(e,void 0,void 0,(function(){var e,r=this;return o(this,(function(o){return e=Date.now(),[2,new Promise((function(o){var s=r;!function r(){var i=s.getEventByLastEventByName(t);void 0===i?Date.now()-e>n?o(void 0):setTimeout(r,1e3):o(i)}()}))]}))}))}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e}();t.ProcessState=s}(M)),M}var H,F={};function L(){return H||(H=1,Object.defineProperty(F,"__esModule",{value:!0}),F.supported_fdi=F.package_version=void 0,F.package_version="19.0.1",F.supported_fdi=["1.16","1.17","1.18","1.19"]),F}var N,j,q={},V={};function W(){if(N)return V;N=1;var t=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},n=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(V,"__esModule",{value:!0}),V.defaultCookieHandlerImplementation=void 0;var r=h();return V.defaultCookieHandlerImplementation={getCookie:function(){return t(this,void 0,void 0,(function(){return n(this,(function(e){return[2,r.default.getReferenceOrThrow().windowHandler.getWindowUnsafe().document.cookie]}))}))},setCookie:function(e){return t(this,void 0,void 0,(function(){return n(this,(function(t){return r.default.getReferenceOrThrow().windowHandler.getWindowUnsafe().document.cookie=e,[2]}))}))}},V}function B(){if(j)return q;j=1,Object.defineProperty(q,"__esModule",{value:!0}),q.CookieHandlerReference=void 0;var e=W(),t=function(){function t(t){var n=function(e){return e};void 0!==t&&(n=t),this.cookieHandler=n(e.defaultCookieHandlerImplementation)}return t.init=function(e){void 0===t.instance&&(t.instance=new t(e))},t.getReferenceOrThrow=function(){if(void 0===t.instance)throw new Error("SuperTokensCookieHandler must be initialized before calling this method.");return t.instance},t}();return q.CookieHandlerReference=t,q.default=t,q}var X,G,z,Q={},J={},K={};function Y(){if(G)return J;G=1;var t=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,a)}u((r=r.apply(e,t||[])).next())}))},n=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},r=e;Object.defineProperty(J,"__esModule",{value:!0});var o=function(){if(X)return K;X=1,Object.defineProperty(K,"__esModule",{value:!0});var e=function(){function e(){var e=this;this.locked=new Map,this.addToLocked=function(t,n){var r=e.locked.get(t);void 0===r?void 0===n?e.locked.set(t,[]):e.locked.set(t,[n]):void 0!==n&&(r.unshift(n),e.locked.set(t,r))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise((function(n,r){e.isLocked(t)?e.addToLocked(t,n):(e.addToLocked(t),n())}))},this.unlock=function(t){var n=e.locked.get(t);if(void 0!==n&&0!==n.length){var r=n.pop();e.locked.set(t,n),void 0!==r&&setTimeout(r,0)}else e.locked.delete(t)}}return e.getInstance=function(){return void 0===e.instance&&(e.instance=new e),e.instance},e}();return K.default=function(){return e.getInstance()},K}(),s="browser-tabs-lock-key",i={key:function(e){return t(r,void 0,void 0,(function(){return n(this,(function(e){throw new Error("Unsupported")}))}))},getItem:function(e){return t(r,void 0,void 0,(function(){return n(this,(function(e){throw new Error("Unsupported")}))}))},clear:function(){return t(r,void 0,void 0,(function(){return n(this,(function(e){return[2,window.localStorage.clear()]}))}))},removeItem:function(e){return t(r,void 0,void 0,(function(){return n(this,(function(e){throw new Error("Unsupported")}))}))},setItem:function(e,o){return t(r,void 0,void 0,(function(){return n(this,(function(e){throw new Error("Unsupported")}))}))},keySync:function(e){return window.localStorage.key(e)},getItemSync:function(e){return window.localStorage.getItem(e)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(e){return window.localStorage.removeItem(e)},setItemSync:function(e,t){return window.localStorage.setItem(e,t)}};function a(e){return new Promise((function(t){return setTimeout(t,e)}))}function u(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="",r=0;r<e;r++){n+=t[Math.floor(61*Math.random())]}return n}var c=function(){function e(t){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+u(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=t,void 0===e.waiters&&(e.waiters=[])}return e.prototype.acquireLock=function(r,o){return void 0===o&&(o=5e3),t(this,void 0,void 0,(function(){var t,c,l,d,f,h,p;return n(this,(function(n){switch(n.label){case 0:t=Date.now()+u(4),c=Date.now()+o,l=s+"-"+r,d=void 0===this.storageHandler?i:this.storageHandler,n.label=1;case 1:return Date.now()<c?[4,a(30)]:[3,8];case 2:return n.sent(),null!==d.getItemSync(l)?[3,5]:(f=this.id+"-"+r+"-"+t,[4,a(Math.floor(25*Math.random()))]);case 3:return n.sent(),d.setItemSync(l,JSON.stringify({id:this.id,iat:t,timeoutKey:f,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,a(30)];case 4:return n.sent(),null!==(h=d.getItemSync(l))&&(p=JSON.parse(h)).id===this.id&&p.iat===t?(this.acquiredIatSet.add(t),this.refreshLockWhileAcquired(l,t),[2,!0]):[3,7];case 5:return e.lockCorrector(void 0===this.storageHandler?i:this.storageHandler),[4,this.waitForSomethingToChange(c)];case 6:n.sent(),n.label=7;case 7:return t=Date.now()+u(4),[3,1];case 8:return[2,!1]}}))}))},e.prototype.refreshLockWhileAcquired=function(e,r){return t(this,void 0,void 0,(function(){var s=this;return n(this,(function(a){return setTimeout((function(){return t(s,void 0,void 0,(function(){var t,s,a;return n(this,(function(n){switch(n.label){case 0:return[4,o.default().lock(r)];case 1:return n.sent(),this.acquiredIatSet.has(r)?(t=void 0===this.storageHandler?i:this.storageHandler,null===(s=t.getItemSync(e))?(o.default().unlock(r),[2]):((a=JSON.parse(s)).timeRefreshed=Date.now(),t.setItemSync(e,JSON.stringify(a)),o.default().unlock(r),this.refreshLockWhileAcquired(e,r),[2])):(o.default().unlock(r),[2])}}))}))}),1e3),[2]}))}))},e.prototype.waitForSomethingToChange=function(r){return t(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){var n=!1,o=Date.now(),s=!1;function i(){if(s||(window.removeEventListener("storage",i),e.removeFromWaiting(i),clearTimeout(a),s=!0),!n){n=!0;var r=50-(Date.now()-o);r>0?setTimeout(t,r):t(null)}}window.addEventListener("storage",i),e.addToWaiting(i);var a=setTimeout(i,Math.max(0,r-Date.now()))}))];case 1:return t.sent(),[2]}}))}))},e.addToWaiting=function(t){this.removeFromWaiting(t),void 0!==e.waiters&&e.waiters.push(t)},e.removeFromWaiting=function(t){void 0!==e.waiters&&(e.waiters=e.waiters.filter((function(e){return e!==t})))},e.notifyWaiters=function(){void 0!==e.waiters&&e.waiters.slice().forEach((function(e){return e()}))},e.prototype.releaseLock=function(e){return t(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,this.releaseLock__private__(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.releaseLock__private__=function(r){return t(this,void 0,void 0,(function(){var t,a,u,c;return n(this,(function(n){switch(n.label){case 0:return t=void 0===this.storageHandler?i:this.storageHandler,a=s+"-"+r,null===(u=t.getItemSync(a))?[2]:(c=JSON.parse(u)).id!==this.id?[3,2]:[4,o.default().lock(c.iat)];case 1:n.sent(),this.acquiredIatSet.delete(c.iat),t.removeItemSync(a),o.default().unlock(c.iat),e.notifyWaiters(),n.label=2;case 2:return[2]}}))}))},e.lockCorrector=function(t){for(var n=Date.now()-5e3,r=t,o=[],i=0;;){var a=r.keySync(i);if(null===a)break;o.push(a),i++}for(var u=!1,c=0;c<o.length;c++){var l=o[c];if(l.includes(s)){var d=r.getItemSync(l);if(null!==d){var f=JSON.parse(d);(void 0===f.timeRefreshed&&f.timeAcquired<n||void 0!==f.timeRefreshed&&f.timeRefreshed<n)&&(r.removeItemSync(l),u=!0)}}}u&&e.notifyWaiters()},e.waiters=void 0,e}();return J.default=c,J}function $(){if(z)return Q;z=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.LockFactoryReference=void 0;var e=Y(),t=function(){function t(e){this.lockFactory=e}return t.init=function(n,r){void 0===this.instance&&(this.instance=new t(null!=n?n:function(t){return function(){return Promise.resolve(new e.default(t))}}(r)))},t.getReferenceOrThrow=function(){if(void 0===t.instance)throw new Error("SuperTokensLockReference must be initialized before calling this method.");return t.instance},t}();return Q.LockFactoryReference=t,Q.default=t,Q}var Z,ee={};function te(){if(Z)return ee;Z=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.logDebugMessage=ee.disableLogging=ee.enableLogging=void 0;var e=L(),t=!1;return ee.enableLogging=function(){t=!0},ee.disableLogging=function(){t=!1},ee.logDebugMessage=function(n){t&&console.log("".concat("com.supertokens",' {t: "').concat((new Date).toISOString(),'", message: "').concat(n,'", supertokens-website-ver: "').concat(e.package_version,'"}'))},ee}var ne,re,oe,se={},ie={};function ae(){if(re)return se;re=1,Object.defineProperty(se,"__esModule",{value:!0}),se.DateProviderReference=void 0;var e=function(){if(ne)return ie;ne=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.DateProvider=void 0;var e=h(),t=function(){function t(){this.clockSkewInMillis=0,this.thresholdInSeconds=7}return t.init=function(){if(void 0===t.instance){t.instance=new t;var n=e.default.getReferenceOrThrow().windowHandler.localStorage.getItemSync(t.CLOCK_SKEW_KEY),r=null!==n?parseInt(n,10):0;t.instance.setClientClockSkewInMillis(r)}},t.getReferenceOrThrow=function(){if(void 0===t.instance)throw new Error("DateProvider must be initialized before calling this method.");return t.instance},t.prototype.getThresholdInSeconds=function(){return this.thresholdInSeconds},t.prototype.setThresholdInSeconds=function(e){this.thresholdInSeconds=e},t.prototype.setClientClockSkewInMillis=function(n){this.clockSkewInMillis=Math.abs(n)>=1e3*this.thresholdInSeconds?n:0,e.default.getReferenceOrThrow().windowHandler.localStorage.setItemSync(t.CLOCK_SKEW_KEY,String(n))},t.prototype.getClientClockSkewInMillis=function(){return this.clockSkewInMillis},t.prototype.now=function(){return Date.now()+this.getClientClockSkewInMillis()},t.CLOCK_SKEW_KEY="__st_clockSkewInMillis",t}();return ie.DateProvider=t,ie}(),t=function(){function t(t){void 0!==t?this.dateProvider=t():(e.DateProvider.init(),this.dateProvider=e.DateProvider.getReferenceOrThrow())}return t.init=function(e){void 0===t.instance&&(t.instance=new t(e))},t.getReferenceOrThrow=function(){if(void 0===t.instance)throw new Error("SuperTokensDateProvider must be initialized before calling this method.");return t.instance},t}();return se.DateProviderReference=t,se.default=t,se}function ue(){return oe||(oe=1,function(t){var n=e&&e.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},r=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},o=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateClockSkewUsingFrontToken=t.fireSessionUpdateEventsIfNecessary=t.setFrontToken=t.getFrontToken=t.setAntiCSRF=t.saveLastAccessTokenUpdate=t.getTokenForHeaderAuth=t.setToken=t.getStorageNameForToken=t.getLocalSessionState=t.onInvalidClaimResponse=t.onTokenUpdate=t.onUnauthorisedResponse=t.FrontToken=t.AntiCsrfToken=void 0;var s=U(),i=L(),a=B(),u=h(),c=$(),l=te(),d=ae(),f=function(){function e(){}return e.getToken=function(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return(0,l.logDebugMessage)("AntiCsrfToken.getToken: called"),void 0===t?(e.tokenInfo=void 0,(0,l.logDebugMessage)("AntiCsrfToken.getToken: returning undefined"),[2,void 0]):void 0!==e.tokenInfo?[3,2]:[4,D()];case 1:return null===(n=r.sent())?((0,l.logDebugMessage)("AntiCsrfToken.getToken: returning undefined"),[2,void 0]):(e.tokenInfo={antiCsrf:n,associatedAccessTokenUpdate:t},[3,4]);case 2:return e.tokenInfo.associatedAccessTokenUpdate===t?[3,4]:(e.tokenInfo=void 0,[4,e.getToken(t)]);case 3:return[2,r.sent()];case 4:return(0,l.logDebugMessage)("AntiCsrfToken.getToken: returning: "+e.tokenInfo.antiCsrf),[2,e.tokenInfo.antiCsrf]}}))}))},e.removeToken=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return(0,l.logDebugMessage)("AntiCsrfToken.removeToken: called"),e.tokenInfo=void 0,[4,M(void 0)];case 1:return t.sent(),[2]}}))}))},e.setItem=function(t,n){return r(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return void 0===t?(e.tokenInfo=void 0,[2]):((0,l.logDebugMessage)("AntiCsrfToken.setItem: called"),[4,M(n)]);case 1:return r.sent(),e.tokenInfo={antiCsrf:n,associatedAccessTokenUpdate:t},[2]}}))}))},e}();t.AntiCsrfToken=f;var p=function(){function e(){}return e.getTokenInfo=function(){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return(0,l.logDebugMessage)("FrontToken.getTokenInfo: called"),[4,N()];case 1:return null!==(t=r.sent())?[3,5]:[4,R(!1)];case 2:return"EXISTS"!==r.sent().status?[3,4]:[4,new Promise((function(t){e.waiters.push(t)}))];case 3:return r.sent(),[2,e.getTokenInfo()];case 4:return[2,void 0];case 5:return n=F(t),(0,l.logDebugMessage)("FrontToken.getTokenInfo: returning ate: "+n.ate),(0,l.logDebugMessage)("FrontToken.getTokenInfo: returning uid: "+n.uid),(0,l.logDebugMessage)("FrontToken.getTokenInfo: returning up: "+n.up),[2,n]}}))}))},e.removeToken=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return(0,l.logDebugMessage)("FrontToken.removeToken: called"),[4,j(void 0)];case 1:return t.sent(),[4,P("access","")];case 2:return t.sent(),[4,P("refresh","")];case 3:return t.sent(),e.waiters.forEach((function(e){return e(void 0)})),e.waiters=[],[2]}}))}))},e.setItem=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,C()];case 1:return n.sent(),"remove"===t?[2,e.removeToken()]:((0,l.logDebugMessage)("FrontToken.setItem: called"),[4,j(t)]);case 2:return n.sent(),e.waiters.forEach((function(e){return e(void 0)})),e.waiters=[],[2]}}))}))},e.doesTokenExists=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,H()];case 1:return[2,null!==e.sent()]}}))}))},e.waiters=[],e}();t.FrontToken=p;var g=function(){function t(){}var i;return t.init=function(n,r){(0,l.logDebugMessage)("init: called"),(0,l.logDebugMessage)("init: Input apiBasePath: "+n.apiBasePath),(0,l.logDebugMessage)("init: Input apiDomain: "+n.apiDomain),(0,l.logDebugMessage)("init: Input autoAddCredentials: "+n.autoAddCredentials),(0,l.logDebugMessage)("init: Input sessionTokenBackendDomain: "+n.sessionTokenBackendDomain),(0,l.logDebugMessage)("init: Input isInIframe: "+n.isInIframe),(0,l.logDebugMessage)("init: Input sessionExpiredStatusCode: "+n.sessionExpiredStatusCode),(0,l.logDebugMessage)("init: Input sessionTokenFrontendDomain: "+n.sessionTokenFrontendDomain),(0,l.logDebugMessage)("init: Input tokenTransferMethod: "+n.tokenTransferMethod);var o=u.default.getReferenceOrThrow().windowHandler.getWindowUnsafe();t.env=void 0===o||void 0===o.fetch?e:o,t.refreshTokenUrl=n.apiDomain+n.apiBasePath+"/session/refresh",t.signOutUrl=n.apiDomain+n.apiBasePath+"/signout",t.rid="session",t.config=n,void 0===t.env.__supertokensOriginalFetch&&((0,l.logDebugMessage)("init: __supertokensOriginalFetch is undefined"),t.env.__supertokensOriginalFetch=t.env.fetch.bind(t.env),t.env.__supertokensSessionRecipe=r,t.env.fetch=t.env.__supertokensSessionRecipe.addFetchInterceptorsAndReturnModifiedFetch({originalFetch:t.env.__supertokensOriginalFetch,userContext:{}}),t.env.__supertokensSessionRecipe.addXMLHttpRequestInterceptor({userContext:{}})),t.recipeImpl=t.env.__supertokensSessionRecipe,t.initCalled=!0},i=t,t.initCalled=!1,t.doRequest=function(e,a,c){return r(void 0,void 0,void 0,(function(){var r,d,h,g,v,m,b,y,w,S,T,P,_;return o(i,(function(o){switch(o.label){case 0:if(!t.initCalled)throw Error("init function not called");(0,l.logDebugMessage)("doRequest: start of fetch interception"),r=!1;try{d=void 0,"string"==typeof c?d=c:"object"==typeof c&&("string"==typeof c.url?d=c.url:"string"==typeof c.href&&(d=c.href)),r=!t.recipeImpl.shouldDoInterceptionBasedOnUrl(d,t.config.apiDomain,t.config.sessionTokenBackendDomain)}catch(e){if("Please provide a valid domain name"!==e.message)throw e;(0,l.logDebugMessage)("doRequest: Trying shouldDoInterceptionBasedOnUrl with location.origin"),r=!t.recipeImpl.shouldDoInterceptionBasedOnUrl(u.default.getReferenceOrThrow().windowHandler.location.getOrigin(),t.config.apiDomain,t.config.sessionTokenBackendDomain)}return(0,l.logDebugMessage)("doRequest: Value of doNotDoInterception: "+r),r?((0,l.logDebugMessage)("doRequest: Returning without interception"),[4,e(a)]):[3,2];case 1:return[2,o.sent()];case 2:return(h=new Headers(void 0!==a&&void 0!==a.headers?a.headers:c.headers)).has("Authorization")?[4,A("access")]:[3,5];case 3:return g=o.sent(),[4,A("refresh")];case 4:v=o.sent(),void 0!==g&&void 0!==v&&h.get("Authorization")==="Bearer ".concat(g)&&((0,l.logDebugMessage)("doRequest: Removing Authorization from user provided headers because it contains our access token"),h.delete("Authorization")),o.label=5;case 5:(0,l.logDebugMessage)("doRequest: Interception started"),s.ProcessState.getInstance().addState(s.PROCESS_STATE.CALLING_INTERCEPTION_REQUEST),o.label=6;case 6:o.trys.push([6,,20,25]),m=void 0,o.label=7;case 7:return[4,R(!0)];case 8:return b=o.sent(),y=new Headers(h),w=n(n({},a),{headers:y}),"EXISTS"!==b.status?[3,10]:[4,f.getToken(b.lastAccessTokenUpdate)];case 9:void 0!==(S=o.sent())&&((0,l.logDebugMessage)("doRequest: Adding anti-csrf token to request"),y.set("anti-csrf",S)),o.label=10;case 10:return t.config.autoAddCredentials&&((0,l.logDebugMessage)("doRequest: Adding credentials include"),void 0===w?w={credentials:"include"}:void 0===w.credentials&&(w=n(n({},w),{credentials:"include"}))),y.has("rid")?(0,l.logDebugMessage)("doRequest: rid header was already there in request"):((0,l.logDebugMessage)("doRequest: Adding rid header: anti-csrf"),y.set("rid","anti-csrf")),T=t.config.tokenTransferMethod,(0,l.logDebugMessage)("doRequest: Adding st-auth-mode header: "+T),y.set("st-auth-mode",T),[4,O(y)];case 11:return o.sent(),(0,l.logDebugMessage)("doRequest: Making user's http call"),[4,e(w)];case 12:return P=o.sent(),(0,l.logDebugMessage)("doRequest: User's http call ended"),[4,x(P)];case 13:return o.sent(),q("EXISTS"===b.status,P.status,P.headers.get("front-token")),P.status!==t.config.sessionExpiredStatusCode?[3,15]:((0,l.logDebugMessage)("doRequest: Status code is: "+P.status),[4,I(b)]);case 14:return"RETRY"!==(_=o.sent()).result?((0,l.logDebugMessage)("doRequest: Not retrying original request"),m=void 0!==_.error?_.error:P,[3,19]):((0,l.logDebugMessage)("doRequest: Retrying original request"),[3,18]);case 15:return P.status!==t.config.invalidClaimStatusCode?[3,17]:[4,k(P)];case 16:o.sent(),o.label=17;case 17:return[2,P];case 18:return[3,7];case 19:return[2,m];case 20:return[4,R(!1)];case 21:return"NOT_EXISTS"!==o.sent().status?[3,24]:((0,l.logDebugMessage)("doRequest: local session doesn't exist, so removing anti-csrf and sFrontToken"),[4,f.removeToken()]);case 22:return o.sent(),[4,p.removeToken()];case 23:o.sent(),o.label=24;case 24:return[7];case 25:return[2]}}))}))},t.attemptRefreshingSession=function(){return r(void 0,void 0,void 0,(function(){var e;return o(i,(function(n){switch(n.label){case 0:if(!t.initCalled)throw Error("init function not called");return[4,R(!1)];case 1:return[4,I(n.sent())];case 2:if("API_ERROR"===(e=n.sent()).result)throw e.error;return[2,"RETRY"===e.result]}}))}))},t}();t.default=g;var v="st-last-access-token-update",m="st-refresh-token",b="st-access-token",y="sAntiCsrf",w="sFrontToken";function I(e){return r(this,void 0,void 0,(function(){var t,n,r,s,a,u,d,h,v,m;return o(this,(function(o){switch(o.label){case 0:return[4,c.default.getReferenceOrThrow().lockFactory()];case 1:t=o.sent(),o.label=2;case 2:return(0,l.logDebugMessage)("onUnauthorisedResponse: trying to acquire lock"),[4,t.acquireLock("REFRESH_TOKEN_USE",1e3)];case 3:if(!o.sent())return[3,24];(0,l.logDebugMessage)("onUnauthorisedResponse: lock acquired"),o.label=4;case 4:return o.trys.push([4,16,18,24]),[4,R(!1)];case 5:return"NOT_EXISTS"===(n=o.sent()).status?((0,l.logDebugMessage)("onUnauthorisedResponse: Not refreshing because local session state is NOT_EXISTS"),g.config.onHandleEvent({action:"UNAUTHORISED",sessionExpiredOrRevoked:!1,userContext:{}}),[2,{result:"SESSION_EXPIRED"}]):n.status!==e.status||"EXISTS"===n.status&&"EXISTS"===e.status&&n.lastAccessTokenUpdate!==e.lastAccessTokenUpdate?((0,l.logDebugMessage)("onUnauthorisedResponse: Retrying early because pre and post lastAccessTokenUpdate don't match"),[2,{result:"RETRY"}]):(r=new Headers,"EXISTS"!==e.status?[3,7]:[4,f.getToken(e.lastAccessTokenUpdate)]);case 6:void 0!==(s=o.sent())&&((0,l.logDebugMessage)("onUnauthorisedResponse: Adding anti-csrf token to refresh API call"),r.set("anti-csrf",s)),o.label=7;case 7:return(0,l.logDebugMessage)("onUnauthorisedResponse: Adding rid and fdi-versions to refresh call header"),r.set("rid",g.rid),r.set("fdi-version",i.supported_fdi.join(",")),a=g.config.tokenTransferMethod,(0,l.logDebugMessage)("onUnauthorisedResponse: Adding st-auth-mode header: "+a),r.set("st-auth-mode",a),[4,O(r,!0)];case 8:return o.sent(),(0,l.logDebugMessage)("onUnauthorisedResponse: Calling refresh pre API hook"),[4,g.config.preAPIHook({action:"REFRESH_SESSION",requestInit:{method:"post",credentials:"include",headers:r},url:g.refreshTokenUrl,userContext:{}})];case 9:return u=o.sent(),(0,l.logDebugMessage)("onUnauthorisedResponse: Making refresh call"),[4,g.env.__supertokensOriginalFetch(u.url,u.requestInit)];case 10:return d=o.sent(),(0,l.logDebugMessage)("onUnauthorisedResponse: Refresh call ended"),[4,x(d)];case 11:return o.sent(),(0,l.logDebugMessage)("onUnauthorisedResponse: Refresh status code is: "+d.status),(h=d.status===g.config.sessionExpiredStatusCode)&&null===d.headers.get("front-token")?[4,p.setItem("remove")]:[3,13];case 12:o.sent(),o.label=13;case 13:if(q("EXISTS"===e.status,d.status,h&&null===d.headers.get("front-token")?"remove":d.headers.get("front-token")),d.status>=300)throw d;return[4,g.config.postAPIHook({action:"REFRESH_SESSION",fetchResponse:d.clone(),requestInit:u.requestInit,url:u.url,userContext:{}})];case 14:return o.sent(),[4,R(!1)];case 15:return"NOT_EXISTS"===o.sent().status?((0,l.logDebugMessage)("onUnauthorisedResponse: local session doesn't exist, so returning session expired"),[2,{result:"SESSION_EXPIRED"}]):(g.config.onHandleEvent({action:"REFRESH_SESSION",userContext:{}}),(0,l.logDebugMessage)("onUnauthorisedResponse: Sending RETRY signal"),[2,{result:"RETRY"}]);case 16:return v=o.sent(),[4,R(!1)];case 17:return"NOT_EXISTS"===o.sent().status?((0,l.logDebugMessage)("onUnauthorisedResponse: local session doesn't exist, so returning session expired"),[2,{result:"SESSION_EXPIRED",error:v}]):((0,l.logDebugMessage)("onUnauthorisedResponse: sending API_ERROR"),[2,{result:"API_ERROR",error:v}]);case 18:return[4,t.releaseLock("REFRESH_TOKEN_USE")];case 19:return o.sent(),(0,l.logDebugMessage)("onUnauthorisedResponse: Released lock"),[4,R(!1)];case 20:return"NOT_EXISTS"!==o.sent().status?[3,23]:((0,l.logDebugMessage)("onUnauthorisedResponse: local session doesn't exist, so removing anti-csrf and sFrontToken"),[4,f.removeToken()]);case 21:return o.sent(),[4,p.removeToken()];case 22:o.sent(),o.label=23;case 23:return[7];case 24:return[4,R(!1)];case 25:return"NOT_EXISTS"===(m=o.sent()).status?((0,l.logDebugMessage)("onUnauthorisedResponse: lock acquired failed and local session doesn't exist, so sending SESSION_EXPIRED"),[2,{result:"SESSION_EXPIRED"}]):m.status!==e.status||"EXISTS"===m.status&&"EXISTS"===e.status&&m.lastAccessTokenUpdate!==e.lastAccessTokenUpdate?((0,l.logDebugMessage)("onUnauthorisedResponse: lock acquired failed and retrying early because pre and post lastAccessTokenUpdate don't match"),[2,{result:"RETRY"}]):[3,2];case 26:return[2]}}))}))}function S(){(0,l.logDebugMessage)("onTokenUpdate: firing ACCESS_TOKEN_PAYLOAD_UPDATED event"),g.config.onHandleEvent({action:"ACCESS_TOKEN_PAYLOAD_UPDATED",userContext:{}})}function k(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,g.recipeImpl.getInvalidClaimsFromResponse({response:e,userContext:{}})];case 1:return(t=n.sent())&&g.config.onHandleEvent({action:"API_INVALID_CLAIM",claimValidationErrors:t,userContext:{}}),[3,3];case 2:return n.sent(),[3,3];case 3:return[2]}}))}))}function R(e){return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return(0,l.logDebugMessage)("getLocalSessionState: called"),[4,E(v)];case 1:return t=o.sent(),[4,p.doesTokenExists()];case 2:return o.sent()&&void 0!==t?((0,l.logDebugMessage)("getLocalSessionState: returning EXISTS since both frontToken and lastAccessTokenUpdate exists"),[2,{status:"EXISTS",lastAccessTokenUpdate:t}]):[3,3];case 3:return t?((0,l.logDebugMessage)("getLocalSessionState: returning NOT_EXISTS since frontToken was cleared but lastAccessTokenUpdate exists"),[2,{status:"NOT_EXISTS"}]):[3,4];case 4:return n={status:"MAY_EXIST"},e?((0,l.logDebugMessage)("getLocalSessionState: trying to refresh"),[4,I(n)]):[3,7];case 5:return"RETRY"!==(r=o.sent()).result?((0,l.logDebugMessage)("getLocalSessionState: return NOT_EXISTS in case error from backend"+r.result),[2,{status:"NOT_EXISTS"}]):((0,l.logDebugMessage)("getLocalSessionState: Retrying post refresh"),[4,R(e)]);case 6:return[2,o.sent()];case 7:return(0,l.logDebugMessage)("getLocalSessionState: returning: "+n.status),[2,n]}}))}))}function T(e){switch(e){case"access":return b;case"refresh":return m}}function P(e,t){var n=T(e);return""!==t?((0,l.logDebugMessage)("setToken: saved ".concat(e," token into cookies")),_(n,t,Date.now()+31536e5)):((0,l.logDebugMessage)("setToken: cleared ".concat(e," token from cookies")),_(n,t,0))}function _(e,t,n){var r="Fri, 31 Dec 9999 23:59:59 GMT";n!==Number.MAX_SAFE_INTEGER&&(r=new Date(n).toUTCString());var o=g.config.sessionTokenFrontendDomain;return"localhost"===o||o===u.default.getReferenceOrThrow().windowHandler.location.getHostName()?a.default.getReferenceOrThrow().cookieHandler.setCookie("".concat(e,"=").concat(t,";expires=").concat(r,";path=/;samesite=").concat(g.config.isInIframe?"none;secure":"lax")):a.default.getReferenceOrThrow().cookieHandler.setCookie("".concat(e,"=").concat(t,";expires=").concat(r,";domain=").concat(o,";path=/;samesite=").concat(g.config.isInIframe?"none;secure":"lax"))}function A(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,E(T(e))]}))}))}function E(e){return r(this,void 0,void 0,(function(){var t,n,r,s;return o(this,(function(o){switch(o.label){case 0:return n="; ",[4,a.default.getReferenceOrThrow().cookieHandler.getCookie()];case 1:return t=n+o.sent(),(r=t.split("; "+e+"=")).length>=2&&void 0!==(s=r.pop())?[2,s.split(";").shift()]:[2,void 0]}}))}))}function O(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return(0,l.logDebugMessage)("setTokenHeaders: adding existing tokens as header"),[4,A("access")];case 1:return n=o.sent(),[4,A("refresh")];case 2:return r=o.sent(),!t&&void 0===n||void 0===r?(0,l.logDebugMessage)("setAuthorizationHeaderIfRequired: token for header based auth not found"):e.has("Authorization")?(0,l.logDebugMessage)("setAuthorizationHeaderIfRequired: Authorization header defined by the user, not adding"):((0,l.logDebugMessage)("setAuthorizationHeaderIfRequired: added authorization header"),e.set("Authorization","Bearer ".concat(t?r:n))),[2]}}))}))}function x(e){return r(this,void 0,void 0,(function(){var n,r,s,i,a;return o(this,(function(o){switch(o.label){case 0:return(0,l.logDebugMessage)("saveTokensFromHeaders: Saving updated tokens from the response headers"),null===(n=e.headers.get("st-refresh-token"))?[3,2]:((0,l.logDebugMessage)("saveTokensFromHeaders: saving new refresh token"),[4,P("refresh",n)]);case 1:o.sent(),o.label=2;case 2:return null===(r=e.headers.get("st-access-token"))?[3,4]:((0,l.logDebugMessage)("saveTokensFromHeaders: saving new access token"),[4,P("access",r)]);case 3:o.sent(),o.label=4;case 4:return null===(s=e.headers.get("front-token"))?[3,6]:((0,l.logDebugMessage)("saveTokensFromHeaders: Setting sFrontToken: "+s),[4,p.setItem(s)]);case 5:o.sent(),(0,t.updateClockSkewUsingFrontToken)({frontToken:s,responseHeaders:e.headers}),o.label=6;case 6:return null===(i=e.headers.get("anti-csrf"))?[3,9]:[4,R(!0)];case 7:return"EXISTS"!==(a=o.sent()).status?[3,9]:((0,l.logDebugMessage)("saveTokensFromHeaders: Setting anti-csrf token"),[4,f.setItem(a.lastAccessTokenUpdate,i)]);case 8:o.sent(),o.label=9;case 9:return[2]}}))}))}function C(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return(0,l.logDebugMessage)("saveLastAccessTokenUpdate: called"),e=Date.now().toString(),(0,l.logDebugMessage)("saveLastAccessTokenUpdate: setting "+e),[4,_(v,e,Number.MAX_SAFE_INTEGER)];case 1:return t.sent(),[4,_("sIRTFrontend","",0)];case 2:return t.sent(),[2]}}))}))}function D(){return r(this,void 0,void 0,(function(){function e(){return r(this,void 0,void 0,(function(){var e,t,n,r,s;return o(this,(function(o){switch(o.label){case 0:return t="; ",[4,a.default.getReferenceOrThrow().cookieHandler.getCookie()];case 1:return e=t+o.sent(),(n=e.split("; "+y+"=")).length>=2&&void 0!==(r=n.pop())?void 0===(s=r.split(";").shift())?[2,null]:[2,s]:[2,null]}}))}))}var t;return o(this,(function(n){switch(n.label){case 0:return(0,l.logDebugMessage)("getAntiCSRFToken: called"),[4,R(!0)];case 1:return"EXISTS"!==n.sent().status?((0,l.logDebugMessage)("getAntiCSRFToken: Returning because local session state != EXISTS"),[2,null]):[4,e()];case 2:return t=n.sent(),(0,l.logDebugMessage)("getAntiCSRFToken: returning: "+t),[2,t]}}))}))}function M(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return(0,l.logDebugMessage)("setAntiCSRF: called: "+e),void 0===e?[3,2]:[4,_(y,e,Number.MAX_SAFE_INTEGER)];case 1:return t.sent(),[3,4];case 2:return[4,_(y,"",0)];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))}function H(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return(0,l.logDebugMessage)("getFrontTokenFromCookie: called"),[4,E(w)];case 1:return[2,void 0===(e=t.sent())?null:e]}}))}))}function F(e){return JSON.parse(decodeURIComponent(escape(atob(e))))}function N(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return(0,l.logDebugMessage)("getFrontToken: called"),[4,R(!0)];case 1:return"EXISTS"!==t.sent().status?((0,l.logDebugMessage)("getFrontToken: Returning because sIRTFrontend != EXISTS"),[2,null]):[4,H()];case 2:return e=t.sent(),(0,l.logDebugMessage)("getFrontToken: returning: "+e),[2,e]}}))}))}function j(e){return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return(0,l.logDebugMessage)("setFrontToken: called"),[4,H()];case 1:return null!==(t=o.sent())&&void 0!==e&&(n=F(t).up,r=F(e).up,JSON.stringify(n)!==JSON.stringify(r)&&S()),void 0!==e?[3,3]:[4,_(w,"",0)];case 2:return o.sent(),[3,5];case 3:return[4,_(w,e,Number.MAX_SAFE_INTEGER)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function q(e,t,n){if(null!=n){var r="remove"!==n;(0,l.logDebugMessage)("fireSessionUpdateEventsIfNecessary wasLoggedIn: ".concat(e," frontTokenExistsAfter: ").concat(r," status: ").concat(t)),e?r||(t===g.config.sessionExpiredStatusCode?((0,l.logDebugMessage)("onUnauthorisedResponse: firing UNAUTHORISED event"),g.config.onHandleEvent({action:"UNAUTHORISED",sessionExpiredOrRevoked:!0,userContext:{}})):((0,l.logDebugMessage)("onUnauthorisedResponse: firing SIGN_OUT event"),g.config.onHandleEvent({action:"SIGN_OUT",userContext:{}}))):r&&((0,l.logDebugMessage)("onUnauthorisedResponse: firing SESSION_CREATED event"),g.config.onHandleEvent({action:"SESSION_CREATED",userContext:{}}))}else(0,l.logDebugMessage)("fireSessionUpdateEventsIfNecessary returning early because the front token was not updated")}t.onUnauthorisedResponse=I,t.onTokenUpdate=S,t.onInvalidClaimResponse=k,t.getLocalSessionState=R,t.getStorageNameForToken=T,t.setToken=P,t.getTokenForHeaderAuth=A,t.saveLastAccessTokenUpdate=C,t.setAntiCSRF=M,t.getFrontToken=N,t.setFrontToken=j,t.fireSessionUpdateEventsIfNecessary=q;t.updateClockSkewUsingFrontToken=function(e){var t=e.frontToken,n=e.responseHeaders;if((0,l.logDebugMessage)("updateClockSkewUsingFrontToken: frontToken: "+t),null!=t&&"remove"!==t){var r=F(t),o=g.recipeImpl.calculateClockSkewInMillis({accessTokenPayload:r.up,responseHeaders:n});d.default.getReferenceOrThrow().dateProvider.setClientClockSkewInMillis(o),(0,l.logDebugMessage)("updateClockSkewUsingFrontToken: Client clock synchronized successfully")}else(0,l.logDebugMessage)("updateClockSkewUsingFrontToken: the access token payload wasn't updated or is being removed, skipping clock skew update")}}(D)),D}var ce,le={};function de(){if(ce)return le;ce=1,Object.defineProperty(le,"__esModule",{value:!0}),le.SessionClaimValidatorStore=void 0;var e=function(){function e(){}return e.claimValidatorsAddedByOtherRecipes=[],e.addClaimValidatorFromOtherRecipe=function(t){e.claimValidatorsAddedByOtherRecipes.push(t)},e.getClaimValidatorsAddedByOtherRecipes=function(){return e.claimValidatorsAddedByOtherRecipes},e}();return le.SessionClaimValidatorStore=e,le.default=e,le}Object.defineProperty(k,"__esModule",{value:!0}),k.getGlobalClaimValidators=void 0;var fe=x(),he=ue(),pe=de();k.getGlobalClaimValidators=function(e,t){var n=(0,fe.getNormalisedUserContext)(t),r=pe.default.getClaimValidatorsAddedByOtherRecipes(),o=he.default.recipeImpl.getGlobalClaimValidators({claimValidatorsAddedByOtherRecipes:r,userContext:n});return void 0!==e?e(o,n):o},function(e){e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(k)}(S),Object.defineProperty(a,"__esModule",{value:!0}),a.normaliseUser=a.normaliseUserResponse=a.getGlobalClaimValidators=a.getHashFromLocation=a.getNormalisedUserContext=a.checkForSSRErrorAndAppendIfNeeded=a.getAllQueryParams=a.getQueryParams=a.isTest=a.normaliseInputAppInfoOrThrowError=a.appendQueryParamsToURL=void 0;var ge=u,ve=p,me=g,be=b,ye=S;function we(e,t){if("loginMethods"in t)return t;var n=void 0!==t.email?[t.email]:[],r=void 0!==t.phoneNumber?[t.phoneNumber]:[],o=void 0!==t.thirdParty?[t.thirdParty]:[];return{id:t.id,emails:n,phoneNumbers:r,thirdParty:o,isPrimaryUser:!1,tenantIds:t.tenantIds,timeJoined:t.timeJoined,loginMethods:[{recipeId:e,recipeUserId:t.id,timeJoined:t.timeJoined,tenantIds:t.tenantIds,email:t.email,phoneNumber:t.email}]}}a.appendQueryParamsToURL=function(e,t){if(void 0===t)return e;try{var n=new URL(e);return Object.entries(t).forEach((function(e){var t=e[0],r=e[1];n.searchParams.set(t,r)})),n.href}catch(n){var r=e.startsWith("/")?"http:localhost":"http://localhost/",o=new URL("".concat(r).concat(e));return Object.entries(t).forEach((function(e){var t=e[0],n=e[1];o.searchParams.set(t,n)})),"".concat(o.pathname).concat(o.search)}},a.normaliseInputAppInfoOrThrowError=function(e){if(void 0===e)throw new Error("Please provide the appInfo object when calling supertokens.init");if(void 0===e.apiDomain)throw new Error("Please provide your apiDomain inside the appInfo object when calling supertokens.init");if(void 0===e.appName)throw new Error("Please provide your appName inside the appInfo object when calling supertokens.init");var t,n,r=new be.default("");return void 0!==e.apiGatewayPath&&(r=new be.default(e.apiGatewayPath)),{appName:e.appName,apiDomain:new me.default(e.apiDomain),apiBasePath:r.appendPath((t=ve.DEFAULT_API_BASE_PATH,n=e.apiBasePath,void 0!==n?new be.default(n):new be.default(t)))}},a.isTest=function(){try{return"testing"===process.env.TEST_MODE}catch(e){return!1}},a.getQueryParams=function(e){var t=new URLSearchParams(ge.WindowHandlerReference.getReferenceOrThrow().windowHandler.location.getSearch()).get(e);if(null!==t)return t},a.getAllQueryParams=function(){return new URLSearchParams(ge.WindowHandlerReference.getReferenceOrThrow().windowHandler.location.getSearch())},a.checkForSSRErrorAndAppendIfNeeded=function(e){return"undefined"==typeof window&&(e+=ve.SSR_ERROR),e},a.getNormalisedUserContext=function(e){return void 0===e?{}:e},a.getHashFromLocation=function(){return ge.WindowHandlerReference.getReferenceOrThrow().windowHandler.location.getHash().substring(1)},a.getGlobalClaimValidators=function(e){var t=e.overrideGlobalClaimValidators,n=e.userContext;return(0,ye.getGlobalClaimValidators)(t,n)},a.normaliseUserResponse=function(e,t){return"createdNewRecipeUser"in t?t:{createdNewRecipeUser:t.createdNewUser,user:we(e,t.user)}},a.normaliseUser=we;var Ie={},Se={};Object.defineProperty(Se,"__esModule",{value:!0});var ke=function(e){this.config=e};Se.default=ke;var Re,Te,Pe={},_e={},Ae={},Ee={},Oe={};function xe(){if(Re)return Oe;Re=1;var t=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},n=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};function r(e,t,n,r,o){return e.config=t,e.request=r,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}return Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.createAxiosErrorFromAxiosResp=Oe.createAxiosErrorFromFetchResp=void 0,Oe.createAxiosErrorFromFetchResp=function(e){return t(this,void 0,void 0,(function(){var t,o,s,i;return n(this,(function(n){switch(n.label){case 0:if(t={url:e.url,headers:e.headers},null!==(o=e.headers.get("content-type")))return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.text()];case 2:return s=n.sent(),[3,4];case 3:return n.sent(),s="",[3,4];case 4:return[3,11];case 5:return o.includes("application/json")?[4,e.json()]:[3,7];case 6:return s=n.sent(),[3,11];case 7:return o.includes("text/")?[4,e.text()]:[3,9];case 8:return s=n.sent(),[3,11];case 9:return[4,e.blob()];case 10:s=n.sent(),n.label=11;case 11:return i={data:s,status:e.status,statusText:e.statusText,headers:e.headers,config:t,request:void 0},[2,r(new Error("Request failed with status code "+e.status),t,0,void 0,i)]}}))}))},Oe.createAxiosErrorFromAxiosResp=function(e){return t(this,void 0,void 0,(function(){return n(this,(function(t){return[2,r(new Error("Request failed with status code "+e.status),e.config,0,e.request,e)]}))}))},Oe}function Ce(){if(Te)return Ee;Te=1;var t=e&&e.__assign||function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)},n=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.responseErrorInterceptor=Ee.responseInterceptor=Ee.interceptorFunctionRequestFulfilled=void 0;var o=xe(),s=ue(),i=U(),a=h(),u=te();function c(e){var t=void 0===e.url?"":e.url,n=e.baseURL;return void 0!==n&&(t="/"===t.charAt(0)&&"/"===n.charAt(n.length-1)?n+t.substr(1):"/"!==t.charAt(0)&&"/"!==n.charAt(n.length-1)?n+"/"+t:n+t),t}Ee.interceptorFunctionRequestFulfilled=function(e){return n(this,void 0,void 0,(function(){var n,o,l,f,h,g;return r(this,(function(r){switch(r.label){case 0:(0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: started axios interception"),n=c(e),o=!1;try{o="string"==typeof n&&!s.default.recipeImpl.shouldDoInterceptionBasedOnUrl(n,s.default.config.apiDomain,s.default.config.sessionTokenBackendDomain)}catch(e){if("Please provide a valid domain name"!==e.message)throw e;(0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Trying shouldDoInterceptionBasedOnUrl with location.origin"),o=!s.default.recipeImpl.shouldDoInterceptionBasedOnUrl(a.default.getReferenceOrThrow().windowHandler.location.getOrigin(),s.default.config.apiDomain,s.default.config.sessionTokenBackendDomain)}return(0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Value of doNotDoInterception: "+o),o?((0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Returning config unchanged"),[2,e]):((0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Modifying config"),i.ProcessState.getInstance().addState(i.PROCESS_STATE.CALLING_INTERCEPTION_REQUEST),[4,(0,s.getLocalSessionState)(!0)]);case 1:return l=r.sent(),f=e,"EXISTS"!==l.status?[3,3]:[4,s.AntiCsrfToken.getToken(l.lastAccessTokenUpdate)];case 2:void 0!==(h=r.sent())&&((0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Adding anti-csrf token to request"),f=t(t({},f),{headers:void 0===f?{"anti-csrf":h}:t(t({},f.headers),{"anti-csrf":h})})),r.label=3;case 3:return s.default.config.autoAddCredentials&&void 0===f.withCredentials&&((0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Adding credentials include"),f=t(t({},f),{withCredentials:!0})),(0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Adding rid header: anti-csrf (it may be overriden by the user's provided rid)"),f=t(t({},f),{headers:void 0===f?{rid:"anti-csrf"}:t({rid:"anti-csrf"},f.headers)}),g=s.default.config.tokenTransferMethod,(0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: Adding st-auth-mode header: "+g),f.headers["st-auth-mode"]=g,[4,p(f)];case 4:return[4,d(f=r.sent())];case 5:return r.sent(),(0,u.logDebugMessage)("interceptorFunctionRequestFulfilled: returning modified config"),[2,f]}}))}))},Ee.responseInterceptor=function(e){var t=this;return function(o){return n(t,void 0,void 0,(function(){var t,n,d,h,p;return r(this,(function(r){switch(r.label){case 0:t=!1,r.label=1;case 1:if(r.trys.push([1,,8,14]),!s.default.initCalled)throw new Error("init function not called");(0,u.logDebugMessage)("responseInterceptor: started"),(0,u.logDebugMessage)("responseInterceptor: already intercepted: "+o.headers["x-supertokens-xhr-intercepted"]),n=c(o.config);try{t="string"==typeof n&&!s.default.recipeImpl.shouldDoInterceptionBasedOnUrl(n,s.default.config.apiDomain,s.default.config.sessionTokenBackendDomain)||!!o.headers["x-supertokens-xhr-intercepted"]}catch(e){if("Please provide a valid domain name"!==e.message)throw e;(0,u.logDebugMessage)("responseInterceptor: Trying shouldDoInterceptionBasedOnUrl with location.origin"),t=!s.default.recipeImpl.shouldDoInterceptionBasedOnUrl(a.default.getReferenceOrThrow().windowHandler.location.getOrigin(),s.default.config.apiDomain,s.default.config.sessionTokenBackendDomain)||!!o.headers["x-supertokens-xhr-intercepted"]}return(0,u.logDebugMessage)("responseInterceptor: Value of doNotDoInterception: "+t),t?((0,u.logDebugMessage)("responseInterceptor: Returning without interception"),[2,o]):((0,u.logDebugMessage)("responseInterceptor: Interception started"),i.ProcessState.getInstance().addState(i.PROCESS_STATE.CALLING_INTERCEPTION_RESPONSE),[4,(0,s.getLocalSessionState)(!1)]);case 2:return d=r.sent(),[4,f(o)];case 3:return r.sent(),(0,s.fireSessionUpdateEventsIfNecessary)("EXISTS"===d.status,o.status,o.headers["front-token"]),o.status!==s.default.config.sessionExpiredStatusCode?[3,4]:((0,u.logDebugMessage)("responseInterceptor: Status code is: "+o.status),h=o.config,[2,l.doRequest((function(t){return e(t)}),h,n,o,void 0,!0)]);case 4:return o.status!==s.default.config.invalidClaimStatusCode?[3,6]:[4,(0,s.onInvalidClaimResponse)(o)];case 5:r.sent(),r.label=6;case 6:return[2,o];case 7:return[3,14];case 8:return(p=!t)?[4,(0,s.getLocalSessionState)(!0)]:[3,10];case 9:p=!("EXISTS"===r.sent().status),r.label=10;case 10:return p?((0,u.logDebugMessage)("responseInterceptor: local session doesn't exist, so removing anti-csrf and sFrontToken"),[4,s.AntiCsrfToken.removeToken()]):[3,13];case 11:return r.sent(),[4,s.FrontToken.removeToken()];case 12:r.sent(),r.label=13;case 13:return[7];case 14:return[2]}}))}))}},Ee.responseErrorInterceptor=function(e){var t=this;return function(o){return n(t,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:if((0,u.logDebugMessage)("responseErrorInterceptor: called"),(0,u.logDebugMessage)("responseErrorInterceptor: already intercepted: "+(o.response&&o.response.headers["x-supertokens-xhr-intercepted"])),o.response.headers["x-supertokens-xhr-intercepted"])throw o;return void 0===o.response||o.response.status!==s.default.config.sessionExpiredStatusCode?[3,1]:((0,u.logDebugMessage)("responseErrorInterceptor: Status code is: "+o.response.status),t=o.config,[2,l.doRequest((function(t){return e(t)}),t,c(t),void 0,o,!0)]);case 1:return void 0===o.response||o.response.status!==s.default.config.invalidClaimStatusCode?[3,3]:[4,(0,s.onInvalidClaimResponse)(o.response)];case 2:n.sent(),n.label=3;case 3:throw o}}))}))}};var l=function(){function e(){}var i;return i=e,e.doRequest=function(e,c,l,h,g,v){return void 0===v&&(v=!1),n(void 0,void 0,void 0,(function(){var n,m,b,y,w,I,S,k,R,T,P,_,A,E;return r(i,(function(r){switch(r.label){case 0:if(!s.default.initCalled)throw Error("init function not called");(0,u.logDebugMessage)("doRequest: called"),n=!1;try{n="string"==typeof l&&!s.default.recipeImpl.shouldDoInterceptionBasedOnUrl(l,s.default.config.apiDomain,s.default.config.sessionTokenBackendDomain)&&v}catch(e){if("Please provide a valid domain name"!==e.message)throw e;(0,u.logDebugMessage)("doRequest: Trying shouldDoInterceptionBasedOnUrl with location.origin"),n=!s.default.recipeImpl.shouldDoInterceptionBasedOnUrl(a.default.getReferenceOrThrow().windowHandler.location.getOrigin(),s.default.config.apiDomain,s.default.config.sessionTokenBackendDomain)&&v}if((0,u.logDebugMessage)("doRequest: Value of doNotDoInterception: "+n),!n)return[3,2];if((0,u.logDebugMessage)("doRequest: Returning without interception"),void 0!==g)throw g;return void 0!==h?[2,h]:[4,e(c)];case 1:return[2,r.sent()];case 2:return(0,u.logDebugMessage)("doRequest: Interception started"),[4,p(c)];case 3:c=r.sent(),r.label=4;case 4:r.trys.push([4,,40,45]),m=void 0,r.label=5;case 5:return[4,(0,s.getLocalSessionState)(!0)];case 6:return b=r.sent(),y=c,"EXISTS"!==b.status?[3,8]:[4,s.AntiCsrfToken.getToken(b.lastAccessTokenUpdate)];case 7:void 0!==(w=r.sent())&&((0,u.logDebugMessage)("doRequest: Adding anti-csrf token to request"),y=t(t({},y),{headers:void 0===y?{"anti-csrf":w}:t(t({},y.headers),{"anti-csrf":w})})),r.label=8;case 8:return s.default.config.autoAddCredentials&&void 0===y.withCredentials&&((0,u.logDebugMessage)("doRequest: Adding credentials include"),y=t(t({},y),{withCredentials:!0})),(0,u.logDebugMessage)("doRequest: Adding rid header: anti-csrf (May get overriden by user's rid)"),y=t(t({},y),{headers:void 0===y?{rid:"anti-csrf"}:t({rid:"anti-csrf"},y.headers)}),I=s.default.config.tokenTransferMethod,(0,u.logDebugMessage)("doRequest: Adding st-auth-mode header: "+I),y.headers["st-auth-mode"]=I,[4,d(y)];case 9:r.sent(),r.label=10;case 10:if(r.trys.push([10,25,,38]),S=g,k=h,g=void 0,h=void 0,void 0!==S)throw(0,u.logDebugMessage)("doRequest: Not making call because localPrevError is not undefined"),S;return void 0!==k?(0,u.logDebugMessage)("doRequest: Not making call because localPrevResponse is not undefined"):(0,u.logDebugMessage)("doRequest: Making user's http call"),void 0!==k?[3,12]:[4,e(y)];case 11:return R=r.sent(),[3,13];case 12:R=k,r.label=13;case 13:return _=R,(0,u.logDebugMessage)("doRequest: User's http call ended"),[4,f(_)];case 14:return r.sent(),(0,s.fireSessionUpdateEventsIfNecessary)("EXISTS"===b.status,_.status,_.headers["front-token"]),_.status!==s.default.config.sessionExpiredStatusCode?[3,21]:((0,u.logDebugMessage)("doRequest: Status code is: "+_.status),[4,(0,s.onUnauthorisedResponse)(b)]);case 15:return"RETRY"===(A=r.sent()).result?[3,20]:((0,u.logDebugMessage)("doRequest: Not retrying original request"),A.error?[4,(0,o.createAxiosErrorFromFetchResp)(A.error)]:[3,17]);case 16:return T=r.sent(),[3,19];case 17:return[4,(0,o.createAxiosErrorFromAxiosResp)(_)];case 18:T=r.sent(),r.label=19;case 19:return m=T,[3,39];case 20:return(0,u.logDebugMessage)("doRequest: Retrying original request"),[3,24];case 21:return _.status!==s.default.config.invalidClaimStatusCode?[3,23]:[4,(0,s.onInvalidClaimResponse)(_)];case 22:r.sent(),r.label=23;case 23:return[2,_];case 24:return[3,38];case 25:return P=r.sent(),void 0===(_=P.response)?[3,36]:[4,f(_)];case 26:return r.sent(),(0,s.fireSessionUpdateEventsIfNecessary)("EXISTS"===b.status,_.status,_.headers["front-token"]),_.status!==s.default.config.sessionExpiredStatusCode?[3,32]:((0,u.logDebugMessage)("doRequest: Status code is: "+_.status),[4,(0,s.onUnauthorisedResponse)(b)]);case 27:return"RETRY"===(A=r.sent()).result?[3,31]:((0,u.logDebugMessage)("doRequest: Not retrying original request"),void 0===A.error?[3,29]:[4,(0,o.createAxiosErrorFromFetchResp)(A.error)]);case 28:return E=r.sent(),[3,30];case 29:E=P,r.label=30;case 30:return m=E,[3,39];case 31:return(0,u.logDebugMessage)("doRequest: Retrying original request"),[3,35];case 32:return _.status!==s.default.config.invalidClaimStatusCode?[3,34]:[4,(0,s.onInvalidClaimResponse)(_)];case 33:r.sent(),r.label=34;case 34:throw P;case 35:return[3,37];case 36:throw P;case 37:return[3,38];case 38:return[3,5];case 39:throw m;case 40:return[4,(0,s.getLocalSessionState)(!1)];case 41:return"NOT_EXISTS"!==r.sent().status?[3,44]:((0,u.logDebugMessage)("doRequest: local session doesn't exist, so removing anti-csrf and sFrontToken"),[4,s.AntiCsrfToken.removeToken()]);case 42:return r.sent(),[4,s.FrontToken.removeToken()];case 43:r.sent(),r.label=44;case 44:return[7];case 45:return[2]}}))}))},e}();function d(e){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return void 0===e.headers&&(e.headers={}),(0,u.logDebugMessage)("setAuthorizationHeaderIfRequired: adding existing tokens as header"),[4,(0,s.getTokenForHeaderAuth)("access")];case 1:return n=r.sent(),[4,(0,s.getTokenForHeaderAuth)("refresh")];case 2:return o=r.sent(),void 0!==n&&void 0!==o?void 0!==e.headers.Authorization||void 0!==e.headers.authorization?(0,u.logDebugMessage)("setAuthorizationHeaderIfRequired: Authorization header defined by the user, not adding"):((0,u.logDebugMessage)("setAuthorizationHeaderIfRequired: added authorization header"),e.headers=t(t({},e.headers),{Authorization:"Bearer ".concat(n)}),e.__supertokensAddedAuthHeader=!0):(0,u.logDebugMessage)("setAuthorizationHeaderIfRequired: token for header based auth not found"),[2]}}))}))}function f(e){return n(this,void 0,void 0,(function(){var t,n,o,i,a,c;return r(this,(function(r){switch(r.label){case 0:return(0,u.logDebugMessage)("saveTokensFromHeaders: Saving updated tokens from the response"),void 0===(t=e.headers["st-refresh-token"])?[3,2]:((0,u.logDebugMessage)("saveTokensFromHeaders: saving new refresh token"),[4,(0,s.setToken)("refresh",t)]);case 1:r.sent(),r.label=2;case 2:return void 0===(n=e.headers["st-access-token"])?[3,4]:((0,u.logDebugMessage)("saveTokensFromHeaders: saving new access token"),[4,(0,s.setToken)("access",n)]);case 3:r.sent(),r.label=4;case 4:return void 0===(o=e.headers["front-token"])?[3,6]:((0,u.logDebugMessage)("doRequest: Setting sFrontToken: "+o),[4,s.FrontToken.setItem(o)]);case 5:r.sent(),i=new Headers,Object.entries(e.headers).forEach((function(e){var t=e[0],n=e[1];Array.isArray(n)?n.forEach((function(e){return i.append(t,e)})):i.append(t,n)})),(0,s.updateClockSkewUsingFrontToken)({frontToken:o,responseHeaders:i}),r.label=6;case 6:return void 0===(a=e.headers["anti-csrf"])?[3,9]:[4,(0,s.getLocalSessionState)(!0)];case 7:return"EXISTS"!==(c=r.sent()).status?[3,9]:((0,u.logDebugMessage)("doRequest: Setting anti-csrf token"),[4,s.AntiCsrfToken.setItem(c.lastAccessTokenUpdate,a)]);case 8:r.sent(),r.label=9;case 9:return[2]}}))}))}function p(e){return n(this,void 0,void 0,(function(){var n,o,i,a;return r(this,(function(r){switch(r.label){case 0:return[4,(0,s.getTokenForHeaderAuth)("access")];case 1:return n=r.sent(),[4,(0,s.getTokenForHeaderAuth)("refresh")];case 2:return o=r.sent(),i=e.headers.Authorization||e.headers.authorization,void 0===n||void 0===o||i!=="Bearer ".concat(n)&&!("__supertokensAddedAuthHeader"in e)?[2,e]:((0,u.logDebugMessage)("removeAuthHeaderIfMatchesLocalToken: Removing Authorization from user provided headers because it contains our access token"),delete(a=t(t({},e),{headers:t({},e.headers)})).headers.authorization,delete a.headers.Authorization,[2,a])}}))}))}return Ee.default=l,Ee}var De,Me={};function Ue(){if(De)return Me;De=1;var t,n=e&&e.__extends||(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(Me,"__esModule",{value:!0}),Me.STGeneralError=void 0;var r=function(e){function t(t){var n=e.call(this,t)||this;return n.isSuperTokensGeneralError=!0,n}return n(t,e),t.isThisError=function(e){return!0===e.isSuperTokensGeneralError},t}(Error);return Me.STGeneralError=r,Me}var He,Fe,Le={};function Ne(){if(He)return Le;He=1;var t=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},n=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Le,"__esModule",{value:!0}),Le.addInterceptorsToXMLHttpRequest=void 0;var r=ue(),o=te(),s=h(),i=U(),a=["readystatechange","abort","error","load","loadend","loadstart","progress","timeout"];function u(e){return t(this,void 0,void 0,(function(){var t,r,o,s,i;return n(this,(function(n){switch(n.label){case 0:if(t=e.headers.get("content-type"),r="",o="text",null!==t)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.text()];case 2:return r=n.sent(),[3,4];case 3:return n.sent(),r="",[3,4];case 4:return[3,9];case 5:return t.includes("application/json")?(o="json",i=(s=JSON).stringify,[4,e.json()]):[3,7];case 6:return r=i.apply(s,[n.sent()]),[3,9];case 7:return t.includes("text/")?[4,e.text()]:[3,9];case 8:r=n.sent(),n.label=9;case 9:return[2,{status:e.status,responseText:r,statusText:e.statusText,responseType:o,headers:e.headers}]}}))}))}function c(e,s){return t(this,void 0,void 0,(function(){var t,i;return n(this,(function(n){switch(n.label){case 0:return(0,o.logDebugMessage)("setAuthorizationHeaderIfRequired: adding existing tokens as header"),[4,(0,r.getTokenForHeaderAuth)("access")];case 1:return t=n.sent(),[4,(0,r.getTokenForHeaderAuth)("refresh")];case 2:return i=n.sent(),void 0!==t&&void 0!==i?s.some((function(e){return"authorization"===e.name.toLowerCase()}))?(0,o.logDebugMessage)("setAuthorizationHeaderIfRequired: Authorization header defined by the user, not adding"):void 0!==t&&((0,o.logDebugMessage)("setAuthorizationHeaderIfRequired: added authorization header"),e.setRequestHeader("Authorization","Bearer ".concat(t))):(0,o.logDebugMessage)("setAuthorizationHeaderIfRequired: token for header based auth not found"),[2]}}))}))}function l(e){return t(this,void 0,void 0,(function(){var t,s,i,a,u;return n(this,(function(n){switch(n.label){case 0:return(0,o.logDebugMessage)("saveTokensFromHeaders: Saving updated tokens from the response"),null===(t=e.get("st-refresh-token"))?[3,2]:((0,o.logDebugMessage)("saveTokensFromHeaders: saving new refresh token"),[4,(0,r.setToken)("refresh",t)]);case 1:n.sent(),n.label=2;case 2:return null===(s=e.get("st-access-token"))?[3,4]:((0,o.logDebugMessage)("saveTokensFromHeaders: saving new access token"),[4,(0,r.setToken)("access",s)]);case 3:n.sent(),n.label=4;case 4:return null===(i=e.get("front-token"))?[3,6]:((0,o.logDebugMessage)("saveTokensFromHeaders: Setting sFrontToken: "+i),[4,r.FrontToken.setItem(i)]);case 5:n.sent(),(0,r.updateClockSkewUsingFrontToken)({frontToken:i,responseHeaders:e}),n.label=6;case 6:return null===(a=e.get("anti-csrf"))?[3,9]:[4,(0,r.getLocalSessionState)(!0)];case 7:return"EXISTS"!==(u=n.sent()).status?[3,9]:((0,o.logDebugMessage)("saveTokensFromHeaders: Setting anti-csrf token"),[4,r.AntiCsrfToken.setItem(u.lastAccessTokenUpdate,a)]);case 8:n.sent(),n.label=9;case 9:return[2]}}))}))}return Le.addInterceptorsToXMLHttpRequest=function(){var e=new Promise((function(e){return setTimeout(e,0)})),d=XMLHttpRequest;(0,o.logDebugMessage)("addInterceptorsToXMLHttpRequest called"),XMLHttpRequest=function(){var f=new d,h=e;function p(e){h=h.finally((function(){var t;return null===(t=e())||void 0===t?void 0:t.catch(console.error)}))}var g,v,m=this,b=[],y=[],w={},I=new Map,S="",k=!1,R=void 0;function T(e,t){var n=I.get(e);(0,o.logDebugMessage)("XHRInterceptor dispatching ".concat(t.type," to ").concat(n?n.size:0," listeners")),n&&Array.from(n).forEach((function(e){return e.apply(m,[t])}))}function P(){return t(this,void 0,void 0,(function(){var e,t;return n(this,(function(n){switch(n.label){case 0:if(void 0===R)throw new Error("Should never come here..");return(0,o.logDebugMessage)("XHRInterceptor.handleRetryPostRefreshing: preRequestLSS "+R.status),[4,(0,r.onUnauthorisedResponse)(R)];case 1:if("RETRY"!==(e=n.sent()).result){if((0,o.logDebugMessage)("XHRInterceptor.handleRetryPostRefreshing: Not retrying original request "+!!e.error),void 0!==e.error)throw e.error;return[2,!0]}return(0,o.logDebugMessage)("XHRInterceptor.handleRetryPostRefreshing: Retrying original request"),t=new d,E(m,t,!0),b.forEach((function(e){e(t)})),O(t,v),[2,!1]}}))}))}function _(e){return t(this,void 0,void 0,(function(){var t,s,a,c;return n(this,(function(n){switch(n.label){case 0:if(k)return(0,o.logDebugMessage)("XHRInterceptor.handleResponse: Returning without interception"),[2,!0];n.label=1;case 1:n.trys.push([1,14,,18]),n.label=2;case 2:return n.trys.push([2,,8,13]),(0,o.logDebugMessage)("XHRInterceptor.handleResponse: Interception started"),i.ProcessState.getInstance().addState(i.PROCESS_STATE.CALLING_INTERCEPTION_RESPONSE),t=e.status,s=function(e){return new Headers(e.getAllResponseHeaders().split("\r\n").map((function(e){var t=e.indexOf(": ");return-1===t?["",""]:[e.slice(0,t),e.slice(t+2)]})).filter((function(e){return 0!==e[0].length})))}(e),[4,l(s)];case 3:return n.sent(),(0,r.fireSessionUpdateEventsIfNecessary)("EXISTS"===R.status,t,s.get("front-token")),t!==r.default.config.sessionExpiredStatusCode?[3,5]:((0,o.logDebugMessage)("responseInterceptor: Status code is: "+t),[4,P()]);case 4:return[2,n.sent()];case 5:return t!==r.default.config.invalidClaimStatusCode?[3,7]:[4,(0,r.onInvalidClaimResponse)({data:JSON.parse(e.responseText)})];case 6:n.sent(),n.label=7;case 7:return[2,!0];case 8:return(0,o.logDebugMessage)("XHRInterceptor.handleResponse: doFinallyCheck running"),[4,(0,r.getLocalSessionState)(!1)];case 9:return"EXISTS"===n.sent().status?[3,12]:((0,o.logDebugMessage)("XHRInterceptor.handleResponse: local session doesn't exist, so removing anti-csrf and sFrontToken"),[4,r.AntiCsrfToken.removeToken()]);case 10:return n.sent(),[4,r.FrontToken.removeToken()];case 11:n.sent(),n.label=12;case 12:return[7];case 13:return[3,18];case 14:return a=n.sent(),(0,o.logDebugMessage)("XHRInterceptor.handleResponse: caught error"),void 0===a.status?[3,16]:[4,u(a)];case 15:if(c=n.sent(),w.status=c.status,w.statusText=c.statusText,w.responseType=c.responseType,g=c.headers,"json"===c.responseType)try{w.response=JSON.parse(c.responseText)}catch(e){w.response=c.responseText}else w.response=c.responseText;return w.responseText=c.responseText,[3,17];case 16:T("error",new Event("error")),n.label=17;case 17:return[2,!0];case 18:return[2]}}))}))}m.onload=null,m.onreadystatechange=null,m.onloadend=null,m.addEventListener=function(e,t,n){var r=I.get(e);void 0===r&&(r=new Set,I.set(e,r)),r.add(t)},m.removeEventListener=function(e,t){var n=I.get(e);void 0===n&&(n=new Set,I.set(e,n)),n.delete(t)},m.open=function(e,t){(0,o.logDebugMessage)("XHRInterceptor.open called");var n=arguments;S=t;try{k="string"==typeof S&&!r.default.recipeImpl.shouldDoInterceptionBasedOnUrl(S,r.default.config.apiDomain,r.default.config.sessionTokenBackendDomain)||"string"!=typeof S&&!r.default.recipeImpl.shouldDoInterceptionBasedOnUrl(S.toString(),r.default.config.apiDomain,r.default.config.sessionTokenBackendDomain)}catch(e){if("Please provide a valid domain name"!==e.message)throw e;(0,o.logDebugMessage)("XHRInterceptor.open: Trying shouldDoInterceptionBasedOnUrl with location.origin"),k=!r.default.recipeImpl.shouldDoInterceptionBasedOnUrl(s.default.getReferenceOrThrow().windowHandler.location.getOrigin(),r.default.config.apiDomain,r.default.config.sessionTokenBackendDomain)}p((function(){b.push((function(e){e.open.apply(e,n)})),f.open.apply(f,n)}))},m.send=function(e){O(f,v=e)},m.setRequestHeader=function(e,s){var i=this;(0,o.logDebugMessage)("XHRInterceptor.setRequestHeader: Called with ".concat(e)),k?p((function(){return f.setRequestHeader(e,s)})):"anti-csrf"!==e&&p((function(){return t(i,void 0,void 0,(function(){var t,i;return n(this,(function(n){switch(n.label){case 0:return"authorization"!==e.toLowerCase()?[3,3]:((0,o.logDebugMessage)("XHRInterceptor.setRequestHeader: checking if user provided auth header matches local token"),[4,(0,r.getTokenForHeaderAuth)("access")]);case 1:return t=n.sent(),[4,(0,r.getTokenForHeaderAuth)("refresh")];case 2:if(i=n.sent(),void 0!==t&&void 0!==i&&s==="Bearer ".concat(t))return(0,o.logDebugMessage)("XHRInterceptor.setRequestHeader: skipping Authorization from user provided headers because it contains our access token"),[2];n.label=3;case 3:return b.push((function(t){t.setRequestHeader(e,s)})),y.push({name:e,value:s}),f.setRequestHeader(e,s),[2]}}))}))}))};var A=void 0;function E(e,t,n){var r,s=["load","loadend","readystatechange"];(0,o.logDebugMessage)("XHRInterceptor.setUpXHR called");for(var i=function(e){(0,o.logDebugMessage)("XHRInterceptor added listener for event ".concat(e)),t.addEventListener(e,(function(t){(0,o.logDebugMessage)("XHRInterceptor got event ".concat(e)),s.includes(e)||T(e,t)}))},u=0,c=a;u<c.length;u++){i(c[u])}if(t.onload=function(n){void 0===r&&(r=_(t)),r.then((function(t){t&&(e.onload&&e.onload(n),T("load",n))}))},t.onreadystatechange=function(n){t.readyState===d.DONE?(void 0===r&&(r=_(t)),r.then((function(t){t&&(e.onreadystatechange&&e.onreadystatechange(n),T("readystatechange",n))}))):(e.onreadystatechange&&e.onreadystatechange(n),T("readystatechange",n))},t.onloadend=function(n){void 0===r&&(r=_(t)),r.then((function(t){t&&(e.onloadend&&e.onloadend(n),T("loadend",n))}))},e.getAllResponseHeaders=function(){var e;return g?(e="",g.forEach((function(t,n){return e+="".concat(n,": ").concat(t,"\r\n")}))):e=t.getAllResponseHeaders(),e+"x-supertokens-xhr-intercepted: true\r\n"},e.getResponseHeader=function(e){return"x-supertokens-xhr-intercepted"===e?"true":g?g.get(e):t.getResponseHeader(e)},void 0===A)for(var l in A=[],t)l in e||A.push(l);for(var f=function(r){"function"==typeof t[r]?Object.defineProperty(e,r,{configurable:!0,value:function(){var e=arguments;return n||b.push((function(t){t[r].apply(t,e)})),t[r].apply(t,e)}}):Object.defineProperty(e,r,{configurable:!0,get:function(){return void 0!==w[r]?w[r]:t[r]},set:function(e){n||b.push((function(t){t[r]=e})),(0,o.logDebugMessage)("XHRInterceptor.set[".concat(r,"] = ").concat(e)),t[r]=e}})},h=0,p=A;h<p.length;h++){f(l=p[h])}}function O(e,s){var a=this;if((0,o.logDebugMessage)("XHRInterceptor.send: called"),(0,o.logDebugMessage)("XHRInterceptor.send: Value of doNotDoInterception: "+k),k)return(0,o.logDebugMessage)("XHRInterceptor.send: Returning without interception"),void p((function(){return e.send(s)}));(0,o.logDebugMessage)("XHRInterceptor.send: Interception started"),i.ProcessState.getInstance().addState(i.PROCESS_STATE.CALLING_INTERCEPTION_REQUEST),p((function(){return t(a,void 0,void 0,(function(){var t,i;return n(this,(function(n){switch(n.label){case 0:return[4,(0,r.getLocalSessionState)(!0)];case 1:return"EXISTS"!==(R=n.sent()).status?[3,3]:[4,r.AntiCsrfToken.getToken(R.lastAccessTokenUpdate)];case 2:void 0!==(t=n.sent())&&((0,o.logDebugMessage)("XHRInterceptor.send: Adding anti-csrf token to request"),e.setRequestHeader("anti-csrf",t)),n.label=3;case 3:return r.default.config.autoAddCredentials&&((0,o.logDebugMessage)("XHRInterceptor.send: Adding credentials include"),m.withCredentials=!0),y.some((function(e){return"rid"===e.name}))?(0,o.logDebugMessage)("XHRInterceptor.send: rid header was already there in request"):((0,o.logDebugMessage)("XHRInterceptor.send: Adding rid header: anti-csrf"),e.setRequestHeader("rid","anti-csrf")),i=r.default.config.tokenTransferMethod,y.some((function(e){return"st-auth-mode"===e.name}))?(0,o.logDebugMessage)("XHRInterceptor.send: st-auth-mode header was already there in request"):((0,o.logDebugMessage)("XHRInterceptor.send: Adding st-auth-mode header: "+i),e.setRequestHeader("st-auth-mode",i)),[4,c(e,y)];case 4:return n.sent(),(0,o.logDebugMessage)("XHRInterceptor.send: Making user's http call"),[2,e.send(s)]}}))}))}))}E(m,f,!1)},XMLHttpRequest.__interceptedBySuperTokens=!0,XMLHttpRequest.__original=d},Le}function je(){if(Fe)return Ae;Fe=1;var t=e&&e.__assign||function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)},n=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Ae,"__esModule",{value:!0});var o=ue(),s=Ce(),i=L(),a=te(),u=Ue(),c=Ne(),l=x(),d=ae();return Ae.default=function(e){return{addXMLHttpRequestInterceptor:function(e){(0,a.logDebugMessage)("addXMLHttpRequestInterceptorAndReturnModified: called"),(0,c.addInterceptorsToXMLHttpRequest)()},addFetchInterceptorsAndReturnModifiedFetch:function(e){return(0,a.logDebugMessage)("addFetchInterceptorsAndReturnModifiedFetch: called"),function(s,i){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,o.default.doRequest((function(n){return e.originalFetch("object"==typeof s&&"clone"in s?s.clone():s,t({},n))}),i,s)];case 1:return[2,n.sent()]}}))}))}},addAxiosInterceptors:function(e){if((0,a.logDebugMessage)("addAxiosInterceptors: called"),XMLHttpRequest.__interceptedBySuperTokens)return console.warn("Not adding axios interceptor since XMLHttpRequest is already added. This is just a warning."),console.warn("Our axios and XMLHttpRequest interceptors cannot be used at the same time."),console.warn("Since XMLHttpRequest is added automatically and supports axios by default, you can just remove addAxiosInterceptors from your code."),console.warn("If you want to continue using our axios interceptor, you can override addXMLHttpRequestInterceptor with an empty function."),void(0,a.logDebugMessage)("addAxiosInterceptors: not adding, because XHR interceptors are already in place");for(var t=e.axiosInstance.interceptors.request,o=0;o<t.handlers.length;o++)if(t.handlers[o].fulfilled===s.interceptorFunctionRequestFulfilled)return void(0,a.logDebugMessage)("addAxiosInterceptors: not adding because already added on this instance");e.axiosInstance.interceptors.request.use(s.interceptorFunctionRequestFulfilled,(function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){throw e}))}))})),e.axiosInstance.interceptors.response.use((0,s.responseInterceptor)(e.axiosInstance),(0,s.responseErrorInterceptor)(e.axiosInstance))},getUserId:function(e){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return(0,a.logDebugMessage)("getUserId: called"),[4,o.FrontToken.getTokenInfo()];case 1:if(void 0===(e=t.sent()))throw new Error("No session exists");return(0,a.logDebugMessage)("getUserId: returning: "+e.uid),[2,e.uid]}}))}))},getAccessTokenPayloadSecurely:function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return(0,a.logDebugMessage)("getAccessTokenPayloadSecurely: called"),[4,o.FrontToken.getTokenInfo()];case 1:if(void 0===(t=n.sent()))throw new Error("No session exists");return t.ate<d.default.getReferenceOrThrow().dateProvider.now()?((0,a.logDebugMessage)("getAccessTokenPayloadSecurely: access token expired. Refreshing session"),[4,o.default.attemptRefreshingSession()]):[3,5];case 2:return n.sent()?[4,this.getAccessTokenPayloadSecurely({userContext:e.userContext})]:[3,4];case 3:return[2,n.sent()];case 4:throw new Error("Could not refresh session");case 5:return(0,a.logDebugMessage)("getAccessTokenPayloadSecurely: returning: "+JSON.stringify(t.up)),[2,t.up]}}))}))},doesSessionExist:function(e){return n(this,void 0,void 0,(function(){var e,t;return r(this,(function(n){switch(n.label){case 0:return(0,a.logDebugMessage)("doesSessionExist: called"),[4,o.FrontToken.getTokenInfo()];case 1:return void 0===(e=n.sent())?((0,a.logDebugMessage)("doesSessionExist: access token does not exist locally"),[2,!1]):e.ate<d.default.getReferenceOrThrow().dateProvider.now()?((0,a.logDebugMessage)("doesSessionExist: access token expired. Refreshing session"),[4,(0,o.getLocalSessionState)(!1)]):[3,4];case 2:return t=n.sent(),[4,(0,o.onUnauthorisedResponse)(t)];case 3:return[2,"RETRY"===n.sent().result];case 4:return[2,!0]}}))}))},signOut:function(t){return n(this,void 0,void 0,(function(){var n,s,c,l;return r(this,(function(r){switch(r.label){case 0:return(0,a.logDebugMessage)("signOut: called"),[4,this.doesSessionExist(t)];case 1:return r.sent()?((0,a.logDebugMessage)("signOut: Calling refresh pre API hook"),[4,e.preAPIHook({action:"SIGN_OUT",requestInit:{method:"post",headers:{"fdi-version":i.supported_fdi.join(","),rid:o.default.rid}},url:o.default.signOutUrl,userContext:t.userContext})]):((0,a.logDebugMessage)("signOut: exiting early because session does not exist"),(0,a.logDebugMessage)("signOut: firing SIGN_OUT event"),e.onHandleEvent({action:"SIGN_OUT",userContext:t.userContext}),[2]);case 2:return n=r.sent(),(0,a.logDebugMessage)("signOut: Calling API"),[4,fetch(n.url,n.requestInit)];case 3:if(s=r.sent(),(0,a.logDebugMessage)("signOut: API ended"),(0,a.logDebugMessage)("signOut: API responded with status code: "+s.status),s.status===e.sessionExpiredStatusCode)return[2];if(s.status>=300)throw s;return[4,e.postAPIHook({action:"SIGN_OUT",requestInit:n.requestInit,url:n.url,fetchResponse:s.clone(),userContext:t.userContext})];case 4:return r.sent(),[4,s.clone().json()];case 5:if("GENERAL_ERROR"===(c=r.sent()).status)throw(0,a.logDebugMessage)("doRequest: Throwing general error"),l=void 0===c.message?"No Error Message Provided":c.message,new u.STGeneralError(l);return[2]}}))}))},getInvalidClaimsFromResponse:function(e){return n(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return"body"in e.response?[4,e.response.clone().json()]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t="string"==typeof e.response.data?JSON.parse(e.response.data):e.response.data,n.label=3;case 3:return[2,t.claimValidationErrors]}}))}))},getGlobalClaimValidators:function(e){return e.claimValidatorsAddedByOtherRecipes},validateClaims:function(e){return n(this,void 0,void 0,(function(){var t,n,o,s,i,a,u,c,l;return r(this,(function(r){switch(r.label){case 0:return[4,this.getAccessTokenPayloadSecurely({userContext:e.userContext})];case 1:t=r.sent(),n=0,o=e.claimValidators,r.label=2;case 2:return n<o.length?[4,(c=o[n]).shouldRefresh(t,e.userContext)]:[3,10];case 3:if(!r.sent())return[3,9];r.label=4;case 4:return r.trys.push([4,6,,7]),[4,c.refresh(e.userContext)];case 5:return r.sent(),[3,7];case 6:return s=r.sent(),console.error("Encountered an error while refreshing validator ".concat(c.id),s),[3,7];case 7:return[4,this.getAccessTokenPayloadSecurely({userContext:e.userContext})];case 8:t=r.sent(),r.label=9;case 9:return n++,[3,2];case 10:i=[],a=0,u=e.claimValidators,r.label=11;case 11:return a<u.length?[4,(c=u[a]).validate(t,e.userContext)]:[3,14];case 12:(l=r.sent()).isValid||i.push({id:c.id,reason:l.reason}),r.label=13;case 13:return a++,[3,11];case 14:return[2,i]}}))}))},shouldDoInterceptionBasedOnUrl:function(e,t,n){if((0,a.logDebugMessage)("shouldDoInterceptionBasedOnUrl: toCheckUrl: "+e+" apiDomain: "+t+" sessionTokenBackendDomain: "+n),e.includes("superTokensDoNotDoInterception"))return!1;e=(0,l.normaliseURLDomainOrThrowError)(e);var r=new URL(e),o=r.hostname;if(void 0===n){o=""===r.port?o:o+":"+r.port,t=(0,l.normaliseURLDomainOrThrowError)(t);var s=new URL(t);return o===(""===s.port?s.hostname:s.hostname+":"+s.port)}var i,u=(0,l.normaliseSessionScopeOrThrowError)(n);if(n.split(":").length>1){var c=n.split(":")[n.split(":").length-1];"string"!=typeof(i=c)||isNaN(i)||isNaN(parseFloat(i))||(u+=":"+c,o=""===r.port?o:o+":"+r.port)}return n.startsWith(".")?("."+o).endsWith(u):o===u},calculateClockSkewInMillis:function(e){var t=e.accessTokenPayload;(0,a.logDebugMessage)("calculateClockSkewInMillis: called");var n=null==t?void 0:t.iat;if(void 0===n||"number"!=typeof n)return(0,a.logDebugMessage)("calculateClockSkewInMillis: payload iat is undefined or not a number. This may happen due to an unsupported backend sdk. Returning 0"),0;var r=1e3*n-Date.now();return(0,a.logDebugMessage)("calculateClockSkewInMillis: returning "+r),r}}},Ae}var qe={},Ve={},We=e&&e.__assign||function(){return We=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},We.apply(this,arguments)};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.getProxyObject=void 0,Ve.getProxyObject=function(e){for(var t=We(We({},e),{_call:function(e,t){throw new Error("This function should only be called through the recipe object")}}),n=function(e){"_call"!==e&&(t[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._call(e,t)})},r=0,o=Object.keys(t);r<o.length;r++){n(o[r])}return t},Object.defineProperty(qe,"__esModule",{value:!0}),qe.OverrideableBuilder=void 0;var Be=Ve,Xe=function(){function e(e){this.layers=[e],this.proxies=[]}return e.prototype.override=function(e){for(var t=(0,Be.getProxyObject)(this.layers[0]),n=e(t,this),r=0,o=Object.keys(this.layers[0]);r<o.length;r++){var s=o[r];n[s]===t[s]||"_call"===s?delete n[s]:void 0===n[s]&&(n[s]=null)}return this.layers.push(n),this.proxies.push(t),this},e.prototype.build=function(){var e=this;if(this.result)return this.result;this.result={};for(var t=0,n=this.layers;t<n.length;t++)for(var r=n[t],o=0,s=Object.keys(r);o<s.length;o++){var i=s[o],a=r[i];void 0!==a&&(this.result[i]=null===a?void 0:"function"==typeof a?a.bind(this.result):a)}for(var u=function(t){c.proxies[t]._call=function(n,r){for(var o=t;o>=0;--o){var s=e.layers[o][n];if(null!=s)return s.bind(e.result).apply(void 0,r)}}},c=this,l=0;l<this.proxies.length;++l)u(l);return this.result},e}();qe.OverrideableBuilder=Xe,qe.default=Xe;var Ge,ze={};function Qe(){if(Ge)return ze;Ge=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.PrimitiveClaim=void 0;var e=ae(),t=function(){function t(t){var n=this;this.validators={hasValue:function(t,r,o){void 0===r&&(r=n.defaultMaxAgeInSeconds);var s=e.default.getReferenceOrThrow().dateProvider;return{id:void 0!==o?o:n.id,refresh:function(e){return n.refresh(e)},shouldRefresh:function(e,t){if(void 0!==r&&r<s.getThresholdInSeconds())throw new Error("maxAgeInSeconds must be greater than or equal to the DateProvider threshold value -> ".concat(s.getThresholdInSeconds()));return void 0===n.getValueFromPayload(e,t)||void 0!==r&&e[n.id].t<s.now()-1e3*r},validate:function(e,o){var i=n.getValueFromPayload(e,o);if(void 0===i)return{isValid:!1,reason:{message:"value does not exist",expectedValue:t,actualValue:i}};var a=(s.now()-n.getLastFetchedTime(e,o))/1e3;return void 0!==r&&a>r?{isValid:!1,reason:{message:"expired",ageInSeconds:a,maxAgeInSeconds:r}}:i!==t?{isValid:!1,reason:{message:"wrong value",expectedValue:t,actualValue:i}}:{isValid:!0}}}}},this.id=t.id,this.refresh=t.refresh,this.defaultMaxAgeInSeconds=t.defaultMaxAgeInSeconds}return t.prototype.getValueFromPayload=function(e,t){return void 0!==e[this.id]?e[this.id].v:void 0},t.prototype.getLastFetchedTime=function(e,t){return void 0!==e[this.id]?e[this.id].t:void 0},t}();return ze.PrimitiveClaim=t,ze}var Je,Ke={};function Ye(){if(Je)return Ke;Je=1;var t=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},n=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.PrimitiveArrayClaim=void 0;var r=ae(),o=function(){function e(e){var o=this;this.validators={includes:function(e,s,i){void 0===s&&(s=o.defaultMaxAgeInSeconds);var a=r.default.getReferenceOrThrow().dateProvider;return{id:void 0!==i?i:o.id,refresh:function(e){return o.refresh(e)},shouldRefresh:function(e,t){if(void 0!==s&&s<a.getThresholdInSeconds())throw new Error("maxAgeInSeconds must be greater than or equal to the DateProvider threshold value -> ".concat(a.getThresholdInSeconds()));return void 0===o.getValueFromPayload(e,t)||void 0!==s&&e[o.id].t<a.now()-1e3*s},validate:function(r,i){return t(o,void 0,void 0,(function(){var t,o;return n(this,(function(n){return void 0===(t=this.getValueFromPayload(r,i))?[2,{isValid:!1,reason:{message:"value does not exist",expectedToInclude:e,actualValue:t}}]:(o=(a.now()-this.getLastFetchedTime(r,i))/1e3,void 0!==s&&o>s?[2,{isValid:!1,reason:{message:"expired",ageInSeconds:o,maxAgeInSeconds:s}}]:t.includes(e)?[2,{isValid:!0}]:[2,{isValid:!1,reason:{message:"wrong value",expectedToInclude:e,actualValue:t}}])}))}))}}},excludes:function(e,s,i){void 0===s&&(s=o.defaultMaxAgeInSeconds);var a=r.default.getReferenceOrThrow().dateProvider;return{id:void 0!==i?i:o.id,refresh:function(e){return o.refresh(e)},shouldRefresh:function(e,t){if(void 0!==s&&s<a.getThresholdInSeconds())throw new Error("maxAgeInSeconds must be greater than or equal to the DateProvider threshold value -> ".concat(a.getThresholdInSeconds()));return void 0===o.getValueFromPayload(e,t)||void 0!==s&&e[o.id].t<a.now()-1e3*s},validate:function(r,i){return t(o,void 0,void 0,(function(){var t,o;return n(this,(function(n){return void 0===(t=this.getValueFromPayload(r,i))?[2,{isValid:!1,reason:{message:"value does not exist",expectedToNotInclude:e,actualValue:t}}]:(o=(a.now()-this.getLastFetchedTime(r,i))/1e3,void 0!==s&&o>s?[2,{isValid:!1,reason:{message:"expired",ageInSeconds:o,maxAgeInSeconds:s}}]:t.includes(e)?[2,{isValid:!1,reason:{message:"wrong value",expectedToNotInclude:e,actualValue:t}}]:[2,{isValid:!0}])}))}))}}},includesAll:function(e,s,i){void 0===s&&(s=o.defaultMaxAgeInSeconds);var a=r.default.getReferenceOrThrow().dateProvider;return{id:void 0!==i?i:o.id,refresh:function(e){return o.refresh(e)},shouldRefresh:function(e,t){if(void 0!==s&&s<a.getThresholdInSeconds())throw new Error("maxAgeInSeconds must be greater than or equal to the DateProvider threshold value -> ".concat(a.getThresholdInSeconds()));return void 0===o.getValueFromPayload(e,t)||void 0!==s&&e[o.id].t<a.now()-1e3*s},validate:function(r,i){return t(o,void 0,void 0,(function(){var t,o,u,c;return n(this,(function(n){return void 0===(t=this.getValueFromPayload(r,i))?[2,{isValid:!1,reason:{message:"value does not exist",expectedToInclude:e,actualValue:t}}]:(o=(a.now()-this.getLastFetchedTime(r,i))/1e3,void 0!==s&&o>s?[2,{isValid:!1,reason:{message:"expired",ageInSeconds:o,maxAgeInSeconds:s}}]:(u=new Set(t),[2,(c=e.every((function(e){return u.has(e)})))?{isValid:c}:{isValid:c,reason:{message:"wrong value",expectedToInclude:e,actualValue:t}}]))}))}))}}},includesAny:function(e,s,i){void 0===s&&(s=o.defaultMaxAgeInSeconds);var a=r.default.getReferenceOrThrow().dateProvider;return{id:void 0!==i?i:o.id,refresh:function(e){return o.refresh(e)},shouldRefresh:function(e,t){if(void 0!==s&&s<a.getThresholdInSeconds())throw new Error("maxAgeInSeconds must be greater than or equal to the DateProvider threshold value -> ".concat(a.getThresholdInSeconds()));return void 0===o.getValueFromPayload(e,t)||void 0!==s&&e[o.id].t<a.now()-1e3*s},validate:function(r,i){return t(o,void 0,void 0,(function(){var t,o,u,c;return n(this,(function(n){return void 0===(t=this.getValueFromPayload(r,i))?[2,{isValid:!1,reason:{message:"value does not exist",expectedToInclude:e,actualValue:t}}]:(o=(a.now()-this.getLastFetchedTime(r,i))/1e3,void 0!==s&&o>s?[2,{isValid:!1,reason:{message:"expired",ageInSeconds:o,maxAgeInSeconds:s}}]:(u=new Set(t),[2,(c=e.some((function(e){return u.has(e)})))?{isValid:c}:{isValid:c,reason:{message:"wrong value",expectedToIncludeAtLeastOneOf:e,actualValue:t}}]))}))}))}}},excludesAll:function(e,s,i){void 0===s&&(s=o.defaultMaxAgeInSeconds);var a=r.default.getReferenceOrThrow().dateProvider;return{id:void 0!==i?i:o.id,refresh:function(e){return o.refresh(e)},shouldRefresh:function(e,t){if(void 0!==s&&s<a.getThresholdInSeconds())throw new Error("maxAgeInSeconds must be greater than or equal to the DateProvider threshold value -> ".concat(a.getThresholdInSeconds()));return void 0===o.getValueFromPayload(e,t)||void 0!==s&&e[o.id].t<a.now()-1e3*s},validate:function(r,i){return t(o,void 0,void 0,(function(){var t,o,u,c;return n(this,(function(n){return void 0===(t=this.getValueFromPayload(r,i))?[2,{isValid:!1,reason:{message:"value does not exist",expectedToNotInclude:e,actualValue:t}}]:(o=(a.now()-this.getLastFetchedTime(r,i))/1e3,void 0!==s&&o>s?[2,{isValid:!1,reason:{message:"expired",ageInSeconds:o,maxAgeInSeconds:s}}]:(u=new Set(t),[2,(c=e.every((function(e){return!u.has(e)})))?{isValid:c}:{isValid:c,reason:{message:"wrong value",expectedToNotInclude:e,actualValue:t}}]))}))}))}}}},this.id=e.id,this.refresh=e.refresh,this.defaultMaxAgeInSeconds=e.defaultMaxAgeInSeconds}return e.prototype.getValueFromPayload=function(e,t){return void 0!==e[this.id]?e[this.id].v:void 0},e.prototype.getLastFetchedTime=function(e,t){return void 0!==e[this.id]?e[this.id].t:void 0},e}();return Ke.PrimitiveArrayClaim=o,Ke}var $e,Ze,et,tt={};function nt(){return Ze||(Ze=1,function(t){var n=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BooleanClaim=t.PrimitiveArrayClaim=t.PrimitiveClaim=t.getInvalidClaimsFromResponse=t.getClaimValue=t.validateClaims=t.signOut=t.addAxiosInterceptors=t.doesSessionExist=t.attemptRefreshingSession=t.getAccessToken=t.getAccessTokenPayloadSecurely=t.getUserId=t.init=void 0;var o=ue(),s=je(),i=qe,a=x(),u=B(),c=h(),l=$(),d=de(),f=te(),p=ae(),g=function(){function e(){}var t;return e.init=function(t){u.default.init(t.cookieHandler),c.default.init(t.windowHandler),p.default.init(t.dateProvider),l.default.init(t.lockFactory,c.default.getReferenceOrThrow().windowHandler.localStorage);var n=(0,a.validateAndNormaliseInputOrThrowError)(t);void 0!==t.enableDebugLogs&&t.enableDebugLogs&&(0,f.enableLogging)();var r=new i.default((0,s.default)({onHandleEvent:n.onHandleEvent,preAPIHook:n.preAPIHook,postAPIHook:n.postAPIHook,sessionExpiredStatusCode:n.sessionExpiredStatusCode})).override(n.override.functions).build();o.default.init(n,r),e.axiosInterceptorQueue.forEach((function(e){e()})),e.axiosInterceptorQueue=[]},e.getUserId=function(e){return o.default.recipeImpl.getUserId({userContext:(0,a.getNormalisedUserContext)(void 0===e?void 0:e.userContext)})},e.getAccessTokenPayloadSecurely=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o.default.recipeImpl.getAccessTokenPayloadSecurely({userContext:(0,a.getNormalisedUserContext)(void 0===e?void 0:e.userContext)})]}))}))},t=e,e.axiosInterceptorQueue=[],e.attemptRefreshingSession=function(){return n(void 0,void 0,void 0,(function(){return r(t,(function(e){return[2,o.default.attemptRefreshingSession()]}))}))},e.doesSessionExist=function(e){return o.default.recipeImpl.doesSessionExist({userContext:(0,a.getNormalisedUserContext)(void 0===e?void 0:e.userContext)})},e.addAxiosInterceptors=function(t,n){o.default.initCalled?o.default.recipeImpl.addAxiosInterceptors({axiosInstance:t,userContext:(0,a.getNormalisedUserContext)(n)}):e.axiosInterceptorQueue.push((function(){o.default.recipeImpl.addAxiosInterceptors({axiosInstance:t,userContext:(0,a.getNormalisedUserContext)(n)})}))},e.signOut=function(e){return o.default.recipeImpl.signOut({userContext:(0,a.getNormalisedUserContext)(void 0===e?void 0:e.userContext)})},e.getInvalidClaimsFromResponse=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,o.default.recipeImpl.getInvalidClaimsFromResponse({response:e.response,userContext:(0,a.getNormalisedUserContext)(e.userContext)})]}))}))},e.getClaimValue=function(t){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return n=(0,a.getNormalisedUserContext)(void 0===t?void 0:t.userContext),[4,e.getAccessTokenPayloadSecurely({userContext:n})];case 1:return o=r.sent(),[2,t.claim.getValueFromPayload(o,n)]}}))}))},e.validateClaims=function(e,t){var n=(0,a.getNormalisedUserContext)(t),r=d.SessionClaimValidatorStore.getClaimValidatorsAddedByOtherRecipes(),s=o.default.recipeImpl.getGlobalClaimValidators({claimValidatorsAddedByOtherRecipes:r,userContext:n}),i=void 0!==e?e(s,n):s;return 0===i.length?[]:o.default.recipeImpl.validateClaims({claimValidators:i,userContext:(0,a.getNormalisedUserContext)(t)})},e.getAccessToken=function(e){return n(void 0,void 0,void 0,(function(){return r(t,(function(t){switch(t.label){case 0:return[4,o.default.recipeImpl.doesSessionExist({userContext:(0,a.getNormalisedUserContext)(void 0===e?void 0:e.userContext)})];case 1:return t.sent()?[2,(0,o.getTokenForHeaderAuth)("access")]:[2,void 0]}}))}))},e}();t.default=g,t.init=g.init,t.getUserId=g.getUserId,t.getAccessTokenPayloadSecurely=g.getAccessTokenPayloadSecurely,t.getAccessToken=g.getAccessToken,t.attemptRefreshingSession=g.attemptRefreshingSession,t.doesSessionExist=g.doesSessionExist,t.addAxiosInterceptors=g.addAxiosInterceptors,t.signOut=g.signOut,t.validateClaims=g.validateClaims,t.getClaimValue=g.getClaimValue,t.getInvalidClaimsFromResponse=g.getInvalidClaimsFromResponse;var v=Qe();Object.defineProperty(t,"PrimitiveClaim",{enumerable:!0,get:function(){return v.PrimitiveClaim}});var m=Ye();Object.defineProperty(t,"PrimitiveArrayClaim",{enumerable:!0,get:function(){return m.PrimitiveArrayClaim}});var b=function(){if($e)return tt;$e=1;var t,n=e&&e.__extends||(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),r=e&&e.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};Object.defineProperty(tt,"__esModule",{value:!0}),tt.BooleanClaim=void 0;var o=function(e){function t(t){var n=e.call(this,t)||this;return n.validators=r(r({},n.validators),{isTrue:function(e){return n.validators.hasValue(!0,e)},isFalse:function(e){return n.validators.hasValue(!1,e)}}),n}return n(t,e),t}(Qe().PrimitiveClaim);return tt.BooleanClaim=o,tt}();Object.defineProperty(t,"BooleanClaim",{enumerable:!0,get:function(){return b.BooleanClaim}})}(_e)),_e}function rt(){return et||(et=1,function(e){e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(nt())}(Pe)),Pe}var ot={};Object.defineProperty(ot,"__esModule",{value:!0}),ot.EMAILVERIFICATION_CLAIM_ID=void 0,ot.EMAILVERIFICATION_CLAIM_ID="st-ev";var st,it=e&&e.__extends||(st=function(e,t){return st=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},st(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}st(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),at=e&&e.__assign||function(){return at=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},at.apply(this,arguments)},ut=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},ct=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},lt=e&&e.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,s=t.length;o<s;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Recipe=void 0;var dt=Se,ft=rt(),ht=a,pt=[ot.EMAILVERIFICATION_CLAIM_ID],gt=function(e){function t(t){var n=e.call(this,t)||this;return n.getUserId=function(e){return ft.default.getUserId({userContext:e.userContext})},n.getAccessToken=function(e){return ut(n,void 0,void 0,(function(){return ct(this,(function(t){return[2,ft.default.getAccessToken({userContext:e.userContext})]}))}))},n.getAccessTokenPayloadSecurely=function(e){return ut(n,void 0,void 0,(function(){return ct(this,(function(t){return[2,ft.default.getAccessTokenPayloadSecurely({userContext:e.userContext})]}))}))},n.doesSessionExist=function(e){return ft.default.doesSessionExist({userContext:e.userContext})},n.signOut=function(e){return ft.default.signOut({userContext:e.userContext})},n.attemptRefreshingSession=function(){return ut(n,void 0,void 0,(function(){return ct(this,(function(e){return[2,ft.default.attemptRefreshingSession()]}))}))},n.validateClaims=function(e){return ft.default.validateClaims(e.overrideGlobalClaimValidators,e.userContext)},ft.default.init(at(at({},t),{override:{functions:function(e,n){var r;return n.override((function(e){return at(at({},e),{getGlobalClaimValidators:function(t){var n=e.getGlobalClaimValidators(t);return lt(lt([],n.filter((function(e){return pt.includes(e.id)})),!0),n.filter((function(e){return!pt.includes(e.id)})),!0)}})})),(null===(r=t.override)||void 0===r?void 0:r.functions)&&n.override(t.override.functions),e}},preAPIHook:function(e){return ut(n,void 0,void 0,(function(){var n,r;return ct(this,(function(o){return(n=new Headers(e.requestInit.headers)).set("rid",t.recipeId),r=at(at({},e),{requestInit:at(at({},e.requestInit),{headers:n})}),void 0===t.preAPIHook?[2,r]:[2,t.preAPIHook(e)]}))}))},apiDomain:t.appInfo.apiDomain.getAsStringDangerous(),apiBasePath:t.appInfo.apiBasePath.getAsStringDangerous()})),n}return it(t,e),t.init=function(e){return function(n,r,o){return t.instance=new t(at(at({},e),{appInfo:n,recipeId:t.RECIPE_ID,enableDebugLogs:o})),t.instance}},t.prototype.getClaimValue=function(e){return ft.default.getClaimValue(e)},t.prototype.getInvalidClaimsFromResponse=function(e){return ft.default.getInvalidClaimsFromResponse(e)},t.addAxiosInterceptors=function(e,t){return ft.default.addAxiosInterceptors(e,t)},t.getInstanceOrThrow=function(){if(void 0===t.instance){var e="No instance of Session found. Ensure that the 'Session.init' method is called within the 'SuperTokens.init' recipeList.";throw e=(0,ht.checkForSSRErrorAndAppendIfNeeded)(e),Error(e)}return t.instance},t.reset=function(){(0,ht.isTest)()&&(t.instance=void 0)},t.RECIPE_ID="session",t}(dt.default);Ie.Recipe=gt,Ie.default=gt,function(t){var n=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},r=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getInvalidClaimsFromResponse=t.getClaimValue=t.validateClaims=t.signOut=t.addAxiosInterceptors=t.doesSessionExist=t.attemptRefreshingSession=t.getAccessToken=t.getAccessTokenPayloadSecurely=t.getUserId=t.init=t.BooleanClaim=t.PrimitiveArrayClaim=t.PrimitiveClaim=void 0;var o=a,s=Ie,i=function(){function e(){}return e.init=function(e){return s.default.init(e)},e.getUserId=function(e){return s.default.getInstanceOrThrow().getUserId({userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e.getAccessToken=function(e){return s.default.getInstanceOrThrow().getAccessToken({userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e.getAccessTokenPayloadSecurely=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,s.default.getInstanceOrThrow().getAccessTokenPayloadSecurely({userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})]}))}))},e.attemptRefreshingSession=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,s.default.getInstanceOrThrow().attemptRefreshingSession()]}))}))},e.doesSessionExist=function(e){return s.default.getInstanceOrThrow().doesSessionExist({userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e.addAxiosInterceptors=function(e,t){return s.default.addAxiosInterceptors(e,(0,o.getNormalisedUserContext)(t))},e.signOut=function(e){return s.default.getInstanceOrThrow().signOut({userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e.getClaimValue=function(e){return s.default.getInstanceOrThrow().getClaimValue({claim:e.claim,userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e.validateClaims=function(e){return s.default.getInstanceOrThrow().validateClaims({overrideGlobalClaimValidators:null==e?void 0:e.overrideGlobalClaimValidators,userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e.getInvalidClaimsFromResponse=function(e){return s.default.getInstanceOrThrow().getInvalidClaimsFromResponse({response:e.response,userContext:(0,o.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e}();t.default=i;var u=i.init;t.init=u;var c=i.getUserId;t.getUserId=c;var l=i.getAccessTokenPayloadSecurely;t.getAccessTokenPayloadSecurely=l;var d=i.getAccessToken;t.getAccessToken=d;var f=i.attemptRefreshingSession;t.attemptRefreshingSession=f;var h=i.doesSessionExist;t.doesSessionExist=h;var p=i.addAxiosInterceptors;t.addAxiosInterceptors=p;var g=i.signOut;t.signOut=g;var v=i.validateClaims;t.validateClaims=v;var m=i.getClaimValue;t.getClaimValue=m;var b=i.getInvalidClaimsFromResponse;t.getInvalidClaimsFromResponse=b;var y=rt();Object.defineProperty(t,"PrimitiveClaim",{enumerable:!0,get:function(){return y.PrimitiveClaim}}),Object.defineProperty(t,"PrimitiveArrayClaim",{enumerable:!0,get:function(){return y.PrimitiveArrayClaim}}),Object.defineProperty(t,"BooleanClaim",{enumerable:!0,get:function(){return y.BooleanClaim}})}(i),function(e){e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(i)}(s);var vt=t(s),mt={},bt={},yt={},wt={},It={};!function(e){e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(B())}(It),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CookieHandlerReference=void 0;var t=It;Object.defineProperty(e,"CookieHandlerReference",{enumerable:!0,get:function(){return t.CookieHandlerReference}})}(wt);var St={};Object.defineProperty(St,"__esModule",{value:!0}),St.PostSuperTokensInitCallbacks=void 0;var kt=function(){function e(){}return e.addPostInitCallback=function(t){e.postInitCallbacks.push(t)},e.runPostInitCallbacks=function(){for(var t=0,n=e.postInitCallbacks;t<n.length;t++){(0,n[t])()}},e.postInitCallbacks=[],e}();St.PostSuperTokensInitCallbacks=kt;var Rt={},Tt={},Pt={},_t={},At=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},Et=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(_t,"__esModule",{value:!0}),_t.normaliseRecipeModuleConfig=void 0,_t.normaliseRecipeModuleConfig=function(e){var t=this,n=e.preAPIHook;void 0===n&&(n=function(e){return At(t,void 0,void 0,(function(){return Et(this,(function(t){return[2,e]}))}))});var r=e.postAPIHook;return void 0===r&&(r=function(){return At(t,void 0,void 0,(function(){return Et(this,(function(e){return[2]}))}))}),{recipeId:e.recipeId,appInfo:e.appInfo,clientType:e.clientType,preAPIHook:n,postAPIHook:r}},Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.normaliseAuthRecipe=void 0;var Ot=_t;Pt.normaliseAuthRecipe=function(e){return(0,Ot.normaliseRecipeModuleConfig)(e)};var xt=e&&e.__assign||function(){return xt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},xt.apply(this,arguments)};Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.normaliseUserInput=void 0;var Ct=Pt;Tt.normaliseUserInput=function(e){var t=xt({functions:function(e){return e}},e.override);return xt(xt({},(0,Ct.normaliseAuthRecipe)(e)),{override:t})};var Dt={},Mt={},Ut={};Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.supported_fdi=Ut.package_version=void 0,Ut.package_version="0.10.1",Ut.supported_fdi=["1.17","1.18","1.19"];var Ht={},Ft={};!function(e){function t(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}e.__esModule=!0;let n=Ue();void 0!==n.default?t(n):t({default:n,...n})}(Ft),Object.defineProperty(Ht,"__esModule",{value:!0});var Lt=Ft;Ht.default=Lt.STGeneralError;var Nt=e&&e.__assign||function(){return Nt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Nt.apply(this,arguments)},jt=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},qt=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Mt,"__esModule",{value:!0});var Vt=b,Wt=Ut,Bt=Ht,Xt=function(){function e(e,t){var n=this;this.recipeId=e,this.appInfo=t,this.get=function(e,t,r,o,s,i){return jt(n,void 0,void 0,(function(){var n;return qt(this,(function(a){switch(a.label){case 0:return[4,this.fetch(this.getFullUrl(e,t,o),Nt({method:"GET"},r),s,i)];case 1:return n=a.sent(),[4,this.getResponseJsonOrThrowGeneralError(n)];case 2:return[2,{jsonBody:a.sent(),fetchResponse:n}]}}))}))},this.post=function(e,t,r,o,s){return jt(n,void 0,void 0,(function(){var n;return qt(this,(function(i){switch(i.label){case 0:if(void 0===r.body)throw new Error("Post request must have a body");return[4,this.fetch(this.getFullUrl(e,t),Nt({method:"POST"},r),o,s)];case 1:return n=i.sent(),[4,this.getResponseJsonOrThrowGeneralError(n)];case 2:return[2,{jsonBody:i.sent(),fetchResponse:n}]}}))}))},this.delete=function(e,t,r,o,s){return jt(n,void 0,void 0,(function(){var n;return qt(this,(function(i){switch(i.label){case 0:return[4,this.fetch(this.getFullUrl(e,t),Nt({method:"DELETE"},r),o,s)];case 1:return n=i.sent(),[4,this.getResponseJsonOrThrowGeneralError(n)];case 2:return[2,{jsonBody:i.sent(),fetchResponse:n}]}}))}))},this.put=function(e,t,r,o,s){return jt(n,void 0,void 0,(function(){var n;return qt(this,(function(i){switch(i.label){case 0:return[4,this.fetch(this.getFullUrl(e,t),Nt({method:"PUT"},r),o,s)];case 1:return n=i.sent(),[4,this.getResponseJsonOrThrowGeneralError(n)];case 2:return[2,{jsonBody:i.sent(),fetchResponse:n}]}}))}))},this.fetch=function(e,t,r,o){return jt(n,void 0,void 0,(function(){var n,s,i,a,u,c;return qt(this,(function(l){switch(l.label){case 0:return n=void 0===t?{}:t.headers,[4,this.callPreAPIHook({preAPIHook:r,url:e,requestInit:Nt(Nt({},t),{headers:Nt(Nt({},n),{"fdi-version":Wt.supported_fdi.join(","),"Content-Type":"application/json",rid:this.recipeId})})})];case 1:return s=l.sent(),i=s.requestInit,a=s.url,[4,fetch(a,i)];case 2:if((u=l.sent()).status>=300)throw u;return void 0===o?[3,4]:(c=u.clone(),[4,o({requestInit:i,url:e,fetchResponse:c})]);case 3:l.sent(),l.label=4;case 4:return[2,u]}}))}))},this.callPreAPIHook=function(e){return jt(n,void 0,void 0,(function(){return qt(this,(function(t){switch(t.label){case 0:return void 0===e.preAPIHook?[2,{url:e.url,requestInit:e.requestInit}]:[4,e.preAPIHook({url:e.url,requestInit:e.requestInit})];case 1:return[2,t.sent()]}}))}))},this.getFullUrl=function(e,t,r){var o=n.appInfo.apiBasePath.getAsStringDangerous();void 0!==e&&"public"!==e&&(o="".concat(o,"/").concat(e));var s=new Vt.default(t),i="".concat(n.appInfo.apiDomain.getAsStringDangerous()).concat(o).concat(s.getAsStringDangerous());return void 0===r?i:i+"?"+new URLSearchParams(r)},this.getResponseJsonOrThrowGeneralError=function(e){return jt(n,void 0,void 0,(function(){var t,n;return qt(this,(function(r){switch(r.label){case 0:return[4,e.clone().json()];case 1:if("GENERAL_ERROR"===(t=r.sent()).status)throw n=void 0===t.message?"No Error Message Provided":t.message,new Bt.default(n);return[2,t]}}))}))}}var t;return t=e,e.preparePreAPIHook=function(e){var n=e.recipePreAPIHook,r=e.action,o=e.options,s=e.userContext;return function(e){return jt(void 0,void 0,void 0,(function(){var i;return qt(t,(function(t){switch(t.label){case 0:return[4,n(Nt(Nt({},e),{action:r,userContext:s}))];case 1:return i=t.sent(),void 0===o||void 0===o.preAPIHook?[2,i]:[2,o.preAPIHook({url:i.url,requestInit:i.requestInit,userContext:s})]}}))}))}},e.preparePostAPIHook=function(e){var n=e.recipePostAPIHook,r=e.action,o=e.userContext;return function(e){return jt(void 0,void 0,void 0,(function(){return qt(t,(function(t){switch(t.label){case 0:return[4,n(Nt(Nt({},e),{userContext:o,action:r}))];case 1:return t.sent(),[2]}}))}))}},e}();Mt.default=Xt;var Gt=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},zt=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.getRecipeImplementation=void 0;var Qt=Mt;function Jt(e){var t=new Qt.default(e.recipeId,e.appInfo);return{getTenantId:function(){},getLoginMethods:function(n){var r=n.tenantId,o=n.options,s=n.userContext;return Gt(this,void 0,void 0,(function(){var n,i,a,u,c;return zt(this,(function(l){switch(l.label){case 0:return n={},void 0!==e.clientType&&(n.clientType=e.clientType),[4,t.get(r,"/loginmethods",{},n,Qt.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"GET_LOGIN_METHODS",options:o,userContext:s}),Qt.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"GET_LOGIN_METHODS",userContext:s}))];case 1:return i=l.sent(),a=i.jsonBody,u=i.fetchResponse,void 0===a.firstFactors?(c=[],a.emailPassword.enabled&&c.push("emailpassword"),a.thirdParty.enabled&&c.push("thirdparty"),a.passwordless.enabled&&(c.push("otp-email"),c.push("otp-phone"),c.push("link-email"),c.push("link-phone"))):c=a.firstFactors,[2,{status:"OK",thirdParty:{providers:a.thirdParty.providers},firstFactors:c,fetchResponse:u}]}}))}))}}}Dt.default=Jt,Dt.getRecipeImplementation=Jt;var Kt={},Yt=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$t=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},Zt=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Kt,"__esModule",{value:!0});var en=Ie,tn=function(e){function t(t){var n=e.call(this,t)||this;return n.signOut=function(e){return $t(n,void 0,void 0,(function(){return Zt(this,(function(t){switch(t.label){case 0:return[4,en.default.getInstanceOrThrow().signOut({userContext:e.userContext})];case 1:return[2,t.sent()]}}))}))},n}return Yt(t,e),t}(Se.default);Kt.default=tn;var nn=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rn=e&&e.__assign||function(){return rn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},rn.apply(this,arguments)};Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.Recipe=void 0;var on=Tt,sn=qe,an=Dt,un=a,cn=function(e){function t(t){var n=e.call(this,(0,on.normaliseUserInput)(t))||this,r=new sn.default((0,an.default)({recipeId:n.config.recipeId,appInfo:n.config.appInfo,clientType:n.config.clientType,preAPIHook:n.config.preAPIHook,postAPIHook:n.config.postAPIHook}));return n.recipeImplementation=r.override(n.config.override.functions).build(),n}return nn(t,e),t.init=function(e){return function(n,r){return t.instance=new t(rn(rn({},e),{recipeId:t.RECIPE_ID,appInfo:n,clientType:r})),t.instance}},t.getInstanceOrThrow=function(){if(void 0===t.instance){var e="No instance of Multitenancy found. Ensure that 'SuperTokens.init' method has been called.";throw e=(0,un.checkForSSRErrorAndAppendIfNeeded)(e),Error(e)}return t.instance},t.reset=function(){(0,un.isTest)()&&(t.instance=void 0)},t.RECIPE_ID="multitenancy",t}(Kt.default);Rt.Recipe=cn,Rt.default=cn;var ln={},dn={};!function(e){e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(ae())}(dn),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DateProviderReference=void 0;var t=dn;Object.defineProperty(e,"DateProviderReference",{enumerable:!0,get:function(){return t.DateProviderReference}})}(ln),Object.defineProperty(yt,"__esModule",{value:!0});var fn=a,hn=wt,pn=u,gn=St,vn=Rt,mn=ln,bn=function(){function e(e){var t=this;if(this.recipeList=[],this.appInfo=(0,fn.normaliseInputAppInfoOrThrowError)(e.appInfo),void 0===e.recipeList||0===e.recipeList.length)throw new Error("Please provide at least one recipe to the supertokens.init function call. See https://supertokens.io/docs/emailpassword/quick-setup/frontend");var n=!1;void 0!==e.enableDebugLogs&&(n=e.enableDebugLogs);var r=!1;this.recipeList=e.recipeList.map((function(o){var s=o(t.appInfo,e.clientType,n);return s.config.recipeId===vn.Recipe.RECIPE_ID&&(r=!0),s})),r||this.recipeList.push(vn.Recipe.init()(this.appInfo,e.clientType,n))}return e.init=function(t){hn.CookieHandlerReference.init(t.cookieHandler),pn.WindowHandlerReference.init(t.windowHandler),mn.DateProviderReference.init(t.dateProvider),void 0===e.instance?(e.instance=new e(t),gn.PostSuperTokensInitCallbacks.runPostInitCallbacks()):console.warn("SuperTokens was already initialized")},e.getInstanceOrThrow=function(){if(void 0===e.instance){var t="SuperTokens must be initialized before calling this method.";throw t=(0,fn.checkForSSRErrorAndAppendIfNeeded)(t),new Error(t)}return e.instance},e.reset=function(){(0,fn.isTest)()?e.instance=void 0:console.warn("Calling reset() is only supported during testing")},e}();yt.default=bn,Object.defineProperty(bt,"__esModule",{value:!0}),bt.init=void 0;var yn=yt,wn=function(){function e(){}return e.init=function(e){yn.default.init(e)},e}();bt.default=wn,bt.init=wn.init,function(e){e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(bt)}(mt);var In=t(mt),Sn={},kn={},Rn={},Tn={},Pn={},_n=e&&e.__assign||function(){return _n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},_n.apply(this,arguments)};Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.normaliseUserInput=void 0;var An=Pt;Pn.normaliseUserInput=function(e){var t=_n({functions:function(e){return e}},e.override);return _n(_n({},(0,An.normaliseAuthRecipe)(e)),{override:t})};var En={},On=e&&e.__assign||function(){return On=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},On.apply(this,arguments)},xn=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},Cn=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(En,"__esModule",{value:!0}),En.getRecipeImplementation=void 0;var Dn=Mt,Mn=Rt,Un=a;function Hn(e){var t=new Dn.default(e.recipeId,e.appInfo);return{submitNewPassword:function(n){var r=n.formFields,o=n.options,s=n.userContext;return xn(this,void 0,void 0,(function(){var n,i,a,u,c;return Cn(this,(function(l){switch(l.label){case 0:return n=this.getTenantIdFromURL({userContext:s}),i=this.getResetPasswordTokenFromURL({userContext:s}),[4,t.post(n,"/user/password/reset",{body:JSON.stringify({formFields:r,token:i,method:"token"})},Dn.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"SUBMIT_NEW_PASSWORD",options:o,userContext:s}),Dn.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"SUBMIT_NEW_PASSWORD",userContext:s}))];case 1:return a=l.sent(),u=a.jsonBody,c=a.fetchResponse,"FIELD_ERROR"===u.status?[2,{status:"FIELD_ERROR",formFields:u.formFields,fetchResponse:c}]:"RESET_PASSWORD_INVALID_TOKEN_ERROR"===u.status?[2,{status:u.status,fetchResponse:c}]:[2,On(On({},u),{fetchResponse:c})]}}))}))},sendPasswordResetEmail:function(n){var r=n.formFields,o=n.options,s=n.userContext;return xn(this,void 0,void 0,(function(){var n,i,a,u,c;return Cn(this,(function(l){switch(l.label){case 0:return c=(u=t).post,[4,Mn.default.getInstanceOrThrow().recipeImplementation.getTenantId({userContext:s})];case 1:return[4,c.apply(u,[l.sent(),"/user/password/reset/token",{body:JSON.stringify({formFields:r})},Dn.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"SEND_RESET_PASSWORD_EMAIL",options:o,userContext:s}),Dn.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"SEND_RESET_PASSWORD_EMAIL",userContext:s})])];case 2:return n=l.sent(),i=n.jsonBody,a=n.fetchResponse,"FIELD_ERROR"===i.status?[2,{status:"FIELD_ERROR",formFields:i.formFields,fetchResponse:a}]:"PASSWORD_RESET_NOT_ALLOWED"===i.status?[2,{status:i.status,reason:i.reason,fetchResponse:a}]:[2,{status:i.status,fetchResponse:a}]}}))}))},signUp:function(n){var r=n.formFields,o=n.options,s=n.userContext;return xn(this,void 0,void 0,(function(){var n,i,a,u,c;return Cn(this,(function(l){switch(l.label){case 0:return c=(u=t).post,[4,Mn.default.getInstanceOrThrow().recipeImplementation.getTenantId({userContext:s})];case 1:return[4,c.apply(u,[l.sent(),"/signup",{body:JSON.stringify({formFields:r})},Dn.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"EMAIL_PASSWORD_SIGN_UP",options:o,userContext:s}),Dn.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"EMAIL_PASSWORD_SIGN_UP",userContext:s})])];case 2:return n=l.sent(),i=n.jsonBody,a=n.fetchResponse,"FIELD_ERROR"===i.status?[2,{status:"FIELD_ERROR",formFields:i.formFields,fetchResponse:a}]:"SIGN_UP_NOT_ALLOWED"===i.status?[2,{status:"SIGN_UP_NOT_ALLOWED",reason:i.reason,fetchResponse:a}]:[2,{status:i.status,user:(0,Un.normaliseUser)("emailpassword",i.user),fetchResponse:a}]}}))}))},signIn:function(n){var r=n.formFields,o=n.options,s=n.userContext;return xn(this,void 0,void 0,(function(){var n,i,a,u,c;return Cn(this,(function(l){switch(l.label){case 0:return c=(u=t).post,[4,Mn.default.getInstanceOrThrow().recipeImplementation.getTenantId({userContext:s})];case 1:return[4,c.apply(u,[l.sent(),"/signin",{body:JSON.stringify({formFields:r})},Dn.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"EMAIL_PASSWORD_SIGN_IN",options:o,userContext:s}),Dn.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"EMAIL_PASSWORD_SIGN_IN",userContext:s})])];case 2:return n=l.sent(),i=n.jsonBody,a=n.fetchResponse,"FIELD_ERROR"===i.status?[2,{status:"FIELD_ERROR",formFields:i.formFields,fetchResponse:a}]:"WRONG_CREDENTIALS_ERROR"===i.status?[2,{status:"WRONG_CREDENTIALS_ERROR",fetchResponse:a}]:"SIGN_IN_NOT_ALLOWED"===i.status?[2,{status:"SIGN_IN_NOT_ALLOWED",reason:i.reason,fetchResponse:a}]:[2,{status:"OK",user:(0,Un.normaliseUser)("emailpassword",i.user),fetchResponse:a}]}}))}))},doesEmailExist:function(n){var r=n.email,o=n.options,s=n.userContext;return xn(this,void 0,void 0,(function(){var n,i,a,u,c;return Cn(this,(function(l){switch(l.label){case 0:return c=(u=t).get,[4,Mn.default.getInstanceOrThrow().recipeImplementation.getTenantId({userContext:s})];case 1:return[4,c.apply(u,[l.sent(),"/signup/email/exists",{},{email:r},Dn.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"EMAIL_EXISTS",options:o,userContext:s}),Dn.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"EMAIL_EXISTS",userContext:s})])];case 2:return n=l.sent(),i=n.jsonBody,a=n.fetchResponse,[2,{status:i.status,doesExist:i.exists,fetchResponse:a}]}}))}))},getResetPasswordTokenFromURL:function(){var e=(0,Un.getQueryParams)("token");return void 0===e?"":e},getTenantIdFromURL:function(){return(0,Un.getQueryParams)("tenantId")}}}En.default=Hn,En.getRecipeImplementation=Hn;var Fn=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ln=e&&e.__assign||function(){return Ln=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ln.apply(this,arguments)};Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.Recipe=void 0;var Nn=Pn,jn=En,qn=qe,Vn=a,Wn=function(e){function t(t){var n=e.call(this,(0,Nn.normaliseUserInput)(t))||this,r=new qn.default((0,jn.default)({recipeId:n.config.recipeId,appInfo:n.config.appInfo,clientType:n.config.clientType,preAPIHook:n.config.preAPIHook,postAPIHook:n.config.postAPIHook}));return n.recipeImplementation=r.override(n.config.override.functions).build(),n}return Fn(t,e),t.init=function(e){return function(n,r){return t.instance=new t(Ln(Ln({},e),{recipeId:t.RECIPE_ID,clientType:r,appInfo:n})),t.instance}},t.getInstanceOrThrow=function(){if(void 0===t.instance){var e="No instance of EmailPassword found. Ensure that the 'EmailPassword.init' method is called within the 'SuperTokens.init' recipeList.";throw e=(0,Vn.checkForSSRErrorAndAppendIfNeeded)(e),Error(e)}return t.instance},t.reset=function(){(0,Vn.isTest)()&&(t.instance=void 0)},t.RECIPE_ID="emailpassword",t}(Kt.default);Tn.Recipe=Wn,Tn.default=Wn;var Bn={},Xn={},Gn=e&&e.__assign||function(){return Gn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Gn.apply(this,arguments)};Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.normaliseUserInput=void 0;var zn=Pt;Xn.normaliseUserInput=function(e){var t=Gn({functions:function(e){return e}},e.override);return Gn(Gn({},(0,zn.normaliseAuthRecipe)(e)),{override:t})};var Qn={},Jn=e&&e.__assign||function(){return Jn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Jn.apply(this,arguments)},Kn=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},Yn=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.getRecipeImplementation=void 0;var $n=Mt,Zn=a,er=Ht,tr=u;function nr(e){var t=new $n.default(e.recipeId,e.appInfo);return{getStateAndOtherInfoFromStorage:function(){var e=tr.WindowHandlerReference.getReferenceOrThrow().windowHandler.sessionStorage.getItemSync("supertokens-oauth-state-2");if(null!==e)try{return JSON.parse(e)}catch(e){return}},setStateAndOtherInfoToStorage:function(e){return Kn(this,void 0,void 0,(function(){var t;return Yn(this,(function(n){switch(n.label){case 0:return t=JSON.stringify(Jn({},e.state)),[4,tr.WindowHandlerReference.getReferenceOrThrow().windowHandler.sessionStorage.setItem("supertokens-oauth-state-2",t)];case 1:return n.sent(),[2]}}))}))},getAuthorisationURLWithQueryParamsAndSetState:function(e){return Kn(this,void 0,void 0,(function(){var t,n,r,o;return Yn(this,(function(s){switch(s.label){case 0:return[4,this.getAuthorisationURLFromBackend({thirdPartyId:e.thirdPartyId,tenantId:e.tenantId,redirectURIOnProviderDashboard:e.redirectURIOnProviderDashboard||e.frontendRedirectURI,userContext:e.userContext,options:e.options})];case 1:return t=s.sent(),n=void 0!==e.redirectURIOnProviderDashboard&&e.frontendRedirectURI!==e.redirectURIOnProviderDashboard?e.frontendRedirectURI:void 0,r=this.generateStateToSendToOAuthProvider({frontendRedirectURI:n,userContext:e.userContext}),o=Date.now()+6e5,[4,this.setStateAndOtherInfoToStorage({state:{stateForAuthProvider:r,thirdPartyId:e.thirdPartyId,tenantId:e.tenantId,expiresAt:o,redirectURIOnProviderDashboard:e.redirectURIOnProviderDashboard||e.frontendRedirectURI,pkceCodeVerifier:t.pkceCodeVerifier},userContext:e.userContext})];case 2:return s.sent(),[2,(0,Zn.appendQueryParamsToURL)(t.urlWithQueryParams,{state:r})]}}))}))},getAuthorisationURLFromBackend:function(n){return Kn(this,void 0,void 0,(function(){var r,o,s,i;return Yn(this,(function(a){switch(a.label){case 0:return r={thirdPartyId:n.thirdPartyId,redirectURIOnProviderDashboard:n.redirectURIOnProviderDashboard},void 0!==e.clientType&&(r.clientType=e.clientType),[4,t.get(n.tenantId,"/authorisationurl",{},r,$n.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"GET_AUTHORISATION_URL",options:n.options,userContext:n.userContext}),$n.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"GET_AUTHORISATION_URL",userContext:n.userContext}))];case 1:return o=a.sent(),s=o.jsonBody,i=o.fetchResponse,[2,{status:"OK",urlWithQueryParams:s.urlWithQueryParams,pkceCodeVerifier:s.pkceCodeVerifier,fetchResponse:i}]}}))}))},signInAndUp:function(n){return Kn(this,void 0,void 0,(function(){var r,o,s,i,a,u,c,l,d;return Yn(this,(function(f){switch(f.label){case 0:return r=this.getStateAndOtherInfoFromStorage({userContext:n.userContext}),o=this.getAuthStateFromURL({userContext:n.userContext}),[4,this.verifyAndGetStateOrThrowError({stateFromAuthProvider:o,stateObjectFromStorage:r,userContext:n.userContext})];case 1:if(s=f.sent(),void 0!==(i=this.getAuthErrorFromURL({userContext:n.userContext})))throw new Error("Auth provider responded with error: ".concat(i));return a=(0,Zn.getAllQueryParams)(),u=Object.fromEntries(a),[4,t.post(s.tenantId,"/signinup",{body:JSON.stringify({thirdPartyId:s.thirdPartyId,clientType:e.clientType,redirectURIInfo:{redirectURIOnProviderDashboard:s.redirectURIOnProviderDashboard,redirectURIQueryParams:u,pkceCodeVerifier:s.pkceCodeVerifier}})},$n.default.preparePreAPIHook({recipePreAPIHook:e.preAPIHook,action:"THIRD_PARTY_SIGN_IN_UP",options:n.options,userContext:n.userContext}),$n.default.preparePostAPIHook({recipePostAPIHook:e.postAPIHook,action:"THIRD_PARTY_SIGN_IN_UP",userContext:n.userContext}))];case 2:if(c=f.sent(),l=c.jsonBody,d=c.fetchResponse,"FIELD_ERROR"===l.status)throw new er.default(l.error);return"OK"!==l.status?[2,Jn(Jn({},l),{fetchResponse:d})]:[2,Jn(Jn({status:"OK"},(0,Zn.normaliseUserResponse)("thirdparty",l)),{fetchResponse:d})]}}))}))},generateStateToSendToOAuthProvider:function(e){var t={state:"".concat(1e20).replace(/[018]/g,(function(e){return(parseInt(e)^crypto.getRandomValues(new Uint8Array(1))[0]&15>>parseInt(e)/4).toString(16)}))};return void 0!==e&&void 0!==e.frontendRedirectURI&&(t.frontendRedirectURI=e.frontendRedirectURI),btoa(JSON.stringify(t))},verifyAndGetStateOrThrowError:function(e){return Kn(this,void 0,void 0,(function(){return Yn(this,(function(t){if(void 0===e.stateObjectFromStorage||void 0===e.stateObjectFromStorage.stateForAuthProvider)throw new Error("No valid auth state present in session storage");if(void 0===e.stateFromAuthProvider)throw new Error("No state recieved from auth provider");if(e.stateObjectFromStorage.expiresAt<Date.now())throw new Error("Auth state verification failed. The auth provider took too long to respond");if(e.stateFromAuthProvider!==e.stateObjectFromStorage.stateForAuthProvider)throw new Error("Auth state verification failed. The auth provider responded with an invalid state");return[2,e.stateObjectFromStorage]}))}))},getAuthErrorFromURL:function(){return(0,Zn.getQueryParams)("error")},getAuthStateFromURL:function(){var e=(0,Zn.getQueryParams)("state");return void 0===e?"":e}}}Qn.default=nr,Qn.getRecipeImplementation=nr;var rr=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),or=e&&e.__assign||function(){return or=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},or.apply(this,arguments)};Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.Recipe=void 0;var sr=Xn,ir=qe,ar=Qn,ur=a,cr=function(e){function t(t){var n=e.call(this,(0,sr.normaliseUserInput)(t))||this,r=new ir.default((0,ar.default)({recipeId:n.config.recipeId,appInfo:n.config.appInfo,clientType:n.config.clientType,preAPIHook:n.config.preAPIHook,postAPIHook:n.config.postAPIHook}));return n.recipeImplementation=r.override(n.config.override.functions).build(),n}return rr(t,e),t.init=function(e){return function(n,r){return t.instance=new t(or(or({},e),{recipeId:t.RECIPE_ID,appInfo:n,clientType:r})),t.instance}},t.getInstanceOrThrow=function(){if(void 0===t.instance){var e="No instance of ThirdParty found. Ensure that the 'ThirdParty.init' method is called within the 'SuperTokens.init' recipeList.";throw e=(0,ur.checkForSSRErrorAndAppendIfNeeded)(e),Error(e)}return t.instance},t.reset=function(){(0,ur.isTest)()&&(t.instance=void 0)},t.RECIPE_ID="thirdparty",t}(Kt.default);Bn.Recipe=cr,Bn.default=cr;var lr={},dr=e&&e.__assign||function(){return dr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},dr.apply(this,arguments)};Object.defineProperty(lr,"__esModule",{value:!0}),lr.normaliseUserInput=void 0;var fr=Pt;lr.normaliseUserInput=function(e){var t=dr({functions:function(e){return e}},e.override);return dr(dr({},(0,fr.normaliseAuthRecipe)(e)),{override:t})};var hr={},pr={};Object.defineProperty(pr,"__esModule",{value:!0}),pr.default=function(e){return{doesEmailExist:e.doesEmailExist.bind(e),sendPasswordResetEmail:e.sendPasswordResetEmail.bind(e),submitNewPassword:e.submitNewPassword.bind(e),getResetPasswordTokenFromURL:e.getResetPasswordTokenFromURL.bind(e),signIn:e.emailPasswordSignIn.bind(e),signUp:e.emailPasswordSignUp.bind(e),getTenantIdFromURL:e.getTenantIdFromURL.bind(e)}};var gr={};Object.defineProperty(gr,"__esModule",{value:!0}),gr.default=function(e){return{getAuthorisationURLFromBackend:e.getAuthorisationURLFromBackend.bind(e),getStateAndOtherInfoFromStorage:e.getStateAndOtherInfoFromStorage.bind(e),getAuthorisationURLWithQueryParamsAndSetState:e.getAuthorisationURLWithQueryParamsAndSetState.bind(e),setStateAndOtherInfoToStorage:e.setStateAndOtherInfoToStorage.bind(e),generateStateToSendToOAuthProvider:e.generateStateToSendToOAuthProvider.bind(e),getAuthErrorFromURL:e.getAuthErrorFromURL.bind(e),getAuthStateFromURL:e.getAuthStateFromURL.bind(e),verifyAndGetStateOrThrowError:e.verifyAndGetStateOrThrowError.bind(e),signInAndUp:e.thirdPartySignInAndUp.bind(e)}};var vr=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},mr=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(hr,"__esModule",{value:!0}),hr.getRecipeImplementation=void 0;var br=En,yr=Qn,wr=pr,Ir=gr;function Sr(e){var t=(0,br.default)(e),n=(0,yr.default)(e);return{submitNewPassword:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(n){return[2,t.submitNewPassword.bind((0,wr.default)(this))(e)]}))}))},sendPasswordResetEmail:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(n){return[2,t.sendPasswordResetEmail.bind((0,wr.default)(this))(e)]}))}))},doesEmailExist:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(n){return[2,t.doesEmailExist.bind((0,wr.default)(this))(e)]}))}))},emailPasswordSignUp:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(n){return[2,t.signUp.bind((0,wr.default)(this))(e)]}))}))},emailPasswordSignIn:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(n){return[2,t.signIn.bind((0,wr.default)(this))(e)]}))}))},getResetPasswordTokenFromURL:function(e){return t.getResetPasswordTokenFromURL.bind((0,wr.default)(this))(e)},getAuthorisationURLFromBackend:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(t){return[2,n.getAuthorisationURLFromBackend.bind((0,Ir.default)(this))(e)]}))}))},thirdPartySignInAndUp:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(t){return[2,n.signInAndUp.bind((0,Ir.default)(this))(e)]}))}))},getStateAndOtherInfoFromStorage:function(e){return n.getStateAndOtherInfoFromStorage.bind((0,Ir.default)(this))(e)},setStateAndOtherInfoToStorage:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(t){return[2,n.setStateAndOtherInfoToStorage.bind((0,Ir.default)(this))(e)]}))}))},getAuthorisationURLWithQueryParamsAndSetState:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(t){return[2,n.getAuthorisationURLWithQueryParamsAndSetState.bind((0,Ir.default)(this))(e)]}))}))},generateStateToSendToOAuthProvider:function(e){return n.generateStateToSendToOAuthProvider.bind((0,Ir.default)(this))(e)},verifyAndGetStateOrThrowError:function(e){return vr(this,void 0,void 0,(function(){return mr(this,(function(t){return[2,n.verifyAndGetStateOrThrowError.bind((0,Ir.default)(this))(e)]}))}))},getAuthErrorFromURL:function(e){return n.getAuthErrorFromURL.bind((0,Ir.default)(this))(e)},getAuthStateFromURL:function(e){return n.getAuthStateFromURL.bind((0,Ir.default)(this))(e)},getTenantIdFromURL:function(e){return t.getTenantIdFromURL.bind((0,wr.default)(this))(e)}}}hr.default=Sr,hr.getRecipeImplementation=Sr;var kr=e&&e.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rr=e&&e.__assign||function(){return Rr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Rr.apply(this,arguments)};Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.Recipe=void 0;var Tr=Tn,Pr=Bn,_r=lr,Ar=qe,Er=hr,Or=pr,xr=gr,Cr=a,Dr=function(e){function t(t,n){var r=e.call(this,(0,_r.normaliseUserInput)(t))||this,o=new Ar.default((0,Er.default)({recipeId:r.config.recipeId,appInfo:r.config.appInfo,clientType:r.config.clientType,preAPIHook:r.config.preAPIHook,postAPIHook:r.config.postAPIHook})).override(r.config.override.functions).build();return r.recipeImplementation=o,r.emailPasswordRecipe=void 0===n.emailPassword?new Tr.default({recipeId:r.config.recipeId,appInfo:r.config.appInfo,clientType:r.config.clientType,preAPIHook:t.preAPIHook,postAPIHook:t.postAPIHook,override:{functions:function(){return(0,Or.default)(o)}}}):n.emailPassword,r.thirdPartyRecipe=void 0===n.thirdParty?new Pr.default({recipeId:r.config.recipeId,appInfo:r.config.appInfo,clientType:r.config.clientType,preAPIHook:t.preAPIHook,postAPIHook:t.postAPIHook,override:{functions:function(){return(0,xr.default)(o)}}}):n.thirdParty,r}return kr(t,e),t.getInstanceOrThrow=function(){if(void 0===t.instance){var e="No instance of ThirdPartyEmailPassword found. Ensure that the 'ThirdPartyEmailPassword.init' method is called within the 'SuperTokens.init' recipeList.";throw e=(0,Cr.checkForSSRErrorAndAppendIfNeeded)(e),Error(e)}return t.instance},t.init=function(e){return function(n,r){return t.instance=new t(Rr(Rr({},e),{recipeId:t.RECIPE_ID,appInfo:n,clientType:r}),{emailPassword:void 0,thirdParty:void 0}),t.instance}},t.reset=function(){(0,Cr.isTest)()&&(t.instance=void 0)},t.RECIPE_ID="thirdpartyemailpassword",t}(Kt.default);Rn.Recipe=Dr,Rn.default=Dr;var Mr=e&&e.__assign||function(){return Mr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mr.apply(this,arguments)},Ur=e&&e.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},Hr=e&&e.__generator||function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(kn,"__esModule",{value:!0}),kn.getTenantIdFromURL=kn.getResetPasswordTokenFromURL=kn.signOut=kn.getAuthorisationURLWithQueryParamsAndSetState=kn.thirdPartySignInAndUp=kn.emailPasswordSignIn=kn.emailPasswordSignUp=kn.doesEmailExist=kn.getStateAndOtherInfoFromStorage=kn.sendPasswordResetEmail=kn.submitNewPassword=kn.init=void 0;var Fr=a,Lr=Rt,Nr=Rn,jr=function(){function e(){}return e.init=function(e){return Nr.default.init(e)},e.signOut=function(e){return Nr.default.getInstanceOrThrow().signOut({userContext:(0,Fr.getNormalisedUserContext)(null==e?void 0:e.userContext)})},e.submitNewPassword=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.submitNewPassword(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(e.userContext)}))},e.sendPasswordResetEmail=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.sendPasswordResetEmail(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(e.userContext)}))},e.getStateAndOtherInfoFromStorage=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.getStateAndOtherInfoFromStorage(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(null==e?void 0:e.userContext)}))},e.doesEmailExist=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.doesEmailExist(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(e.userContext)}))},e.emailPasswordSignUp=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.emailPasswordSignUp(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(e.userContext)}))},e.emailPasswordSignIn=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.emailPasswordSignIn(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(e.userContext)}))},e.getResetPasswordTokenFromURL=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.getResetPasswordTokenFromURL(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(null==e?void 0:e.userContext)}))},e.getTenantIdFromURL=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.getTenantIdFromURL(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(null==e?void 0:e.userContext)}))},e.thirdPartySignInAndUp=function(e){return Nr.default.getInstanceOrThrow().recipeImplementation.thirdPartySignInAndUp(Mr(Mr({},e),{userContext:(0,Fr.getNormalisedUserContext)(null==e?void 0:e.userContext)}))},e.getAuthorisationURLWithQueryParamsAndSetState=function(e){return Ur(this,void 0,void 0,(function(){var t,n,r;return Hr(this,(function(o){switch(o.label){case 0:return t=(0,Fr.getNormalisedUserContext)(e.userContext),n=Nr.default.getInstanceOrThrow(),[4,Lr.default.getInstanceOrThrow().recipeImplementation.getTenantId({userContext:t})];case 1:return r=o.sent(),[2,n.recipeImplementation.getAuthorisationURLWithQueryParamsAndSetState(Mr(Mr({tenantId:r},e),{userContext:t}))]}}))}))},e}();kn.default=jr;var qr=jr.init;kn.init=qr;var Vr=jr.submitNewPassword;kn.submitNewPassword=Vr;var Wr=jr.sendPasswordResetEmail;kn.sendPasswordResetEmail=Wr;var Br=jr.getStateAndOtherInfoFromStorage;kn.getStateAndOtherInfoFromStorage=Br;var Xr=jr.doesEmailExist;kn.doesEmailExist=Xr;var Gr=jr.emailPasswordSignUp;kn.emailPasswordSignUp=Gr;var zr=jr.emailPasswordSignIn;kn.emailPasswordSignIn=zr;var Qr=jr.thirdPartySignInAndUp;kn.thirdPartySignInAndUp=Qr;var Jr=jr.getAuthorisationURLWithQueryParamsAndSetState;kn.getAuthorisationURLWithQueryParamsAndSetState=Jr;var Kr=jr.getResetPasswordTokenFromURL;kn.getResetPasswordTokenFromURL=Kr;var Yr=jr.getTenantIdFromURL;kn.getTenantIdFromURL=Yr;var $r=jr.signOut;kn.signOut=$r,function(e){e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(kn)}(Sn);var Zr=t(Sn);const eo=()=>{In.init({appInfo:{apiDomain:"http://localhost:3001",apiBasePath:"",appName:"WC Test"},recipeList:[vt.init(),Zr.init()]})};export{vt as S,eo as s,Sn as t};
